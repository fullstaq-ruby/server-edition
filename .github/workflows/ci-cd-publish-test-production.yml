# WARNING: DO NOT EDIT THIS FILE!!!
#
# This file is autogenerated from .github/workflows/ci-cd-publish-test-production.yml.erb
# by ./internal-scripts/generate-ci-cd-yaml.rb.
# Please edit the .erb file instead, then regenerate YAML
# by running that script.
#
# TIP: run this on your development machine to ensure generate-ci-cd-yaml.rb
# is run automatically as a Git pre-commit hook:
#
#   git config core.hooksPath .githooks

name: 'CI/CD: publish & test against production repos'

on:
  workflow_dispatch:
    inputs:
      ci_artifacts_run_number:
        required: false
      check_id:
        required: false

env:
  BINTRAY_ORG: fullstaq
  CI_ARTIFACTS_BUCKET: fullstaq-ruby-server-edition-ci-artifacts
  CI_ARTIFACTS_RUN_NUMBER: ${{ github.event.inputs.ci_artifacts_run_number || github.run_number }}

jobs:
  # Determines which jobs should be run, or (in case this is a re-run)
  # which jobs can be skipped this time because the last run succeeded.
  # We determine this by checking whether the artifacts produced by jobs
  # exist in this run.
  determine_necessary_jobs:
    name: Determine necessary jobs
    runs-on: ubuntu-20.04
    outputs:
      necessary_jobs: ${{ steps.check.outputs.necessary_jobs }}
    steps:
      - name: Dump inputs
        run: echo "$INPUTS"
        env:
          INPUTS: ${{ toJSON(github.event.inputs) }}

      - name: Mark check as 'in progress'
        uses: LouisBrunner/checks-action@v1.1.0
        if: github.event.inputs.check_id
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          check_id: ${{ github.event.inputs.check_id }}
          status: in_progress
          details_url: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
          output: |
            {
              "summary": "Packages are tested in another workflow.\n[**âžœ See workflow run #${{ github.run_id }} for logs**](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})"
            }

      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: List artifacts built in previous try of same CI run
        run: ./internal-scripts/ci-cd/determine-necessary-jobs/list-artifacts.sh

      - name: Determine necessary jobs
        id: check
        run: ./internal-scripts/ci-cd/determine-necessary-jobs/determine-necessary-jobs.rb


  ### Publish ###

  publish:
    name: Publish packages
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Download artifacts
        run: ./internal-scripts/ci-cd/download-artifacts.sh
        env:
          ARTIFACT_NAMES: |
            common-deb
            common-rpm
            rbenv-deb
            rbenv-rpm
            ruby-pkg_2.7_centos-7_normal ruby-pkg_2.7_centos-7_jemalloc ruby-pkg_2.7_centos-7_malloctrim ruby-pkg_2.7_centos-8_normal ruby-pkg_2.7_centos-8_jemalloc ruby-pkg_2.7_centos-8_malloctrim ruby-pkg_2.7_debian-10_normal ruby-pkg_2.7_debian-10_jemalloc ruby-pkg_2.7_debian-10_malloctrim ruby-pkg_2.7_debian-9_normal ruby-pkg_2.7_debian-9_jemalloc ruby-pkg_2.7_debian-9_malloctrim ruby-pkg_2.7_ubuntu-18.04_normal ruby-pkg_2.7_ubuntu-18.04_jemalloc ruby-pkg_2.7_ubuntu-18.04_malloctrim ruby-pkg_2.7_ubuntu-20.04_normal ruby-pkg_2.7_ubuntu-20.04_jemalloc ruby-pkg_2.7_ubuntu-20.04_malloctrim ruby-pkg_2.6_centos-7_normal ruby-pkg_2.6_centos-7_jemalloc ruby-pkg_2.6_centos-7_malloctrim ruby-pkg_2.6_centos-8_normal ruby-pkg_2.6_centos-8_jemalloc ruby-pkg_2.6_centos-8_malloctrim ruby-pkg_2.6_debian-10_normal ruby-pkg_2.6_debian-10_jemalloc ruby-pkg_2.6_debian-10_malloctrim ruby-pkg_2.6_debian-9_normal ruby-pkg_2.6_debian-9_jemalloc ruby-pkg_2.6_debian-9_malloctrim ruby-pkg_2.6_ubuntu-18.04_normal ruby-pkg_2.6_ubuntu-18.04_jemalloc ruby-pkg_2.6_ubuntu-18.04_malloctrim ruby-pkg_2.6_ubuntu-20.04_normal ruby-pkg_2.6_ubuntu-20.04_jemalloc ruby-pkg_2.6_ubuntu-20.04_malloctrim ruby-pkg_2.5_centos-7_normal ruby-pkg_2.5_centos-7_jemalloc ruby-pkg_2.5_centos-7_malloctrim ruby-pkg_2.5_centos-8_normal ruby-pkg_2.5_centos-8_jemalloc ruby-pkg_2.5_centos-8_malloctrim ruby-pkg_2.5_debian-10_normal ruby-pkg_2.5_debian-10_jemalloc ruby-pkg_2.5_debian-10_malloctrim ruby-pkg_2.5_debian-9_normal ruby-pkg_2.5_debian-9_jemalloc ruby-pkg_2.5_debian-9_malloctrim ruby-pkg_2.5_ubuntu-18.04_normal ruby-pkg_2.5_ubuntu-18.04_jemalloc ruby-pkg_2.5_ubuntu-18.04_malloctrim ruby-pkg_2.5_ubuntu-20.04_normal ruby-pkg_2.5_ubuntu-20.04_jemalloc ruby-pkg_2.5_ubuntu-20.04_malloctrim ruby-pkg_2.7.2_centos-7_normal ruby-pkg_2.7.2_centos-7_jemalloc ruby-pkg_2.7.2_centos-7_malloctrim ruby-pkg_2.7.2_centos-8_normal ruby-pkg_2.7.2_centos-8_jemalloc ruby-pkg_2.7.2_centos-8_malloctrim ruby-pkg_2.7.2_debian-10_normal ruby-pkg_2.7.2_debian-10_jemalloc ruby-pkg_2.7.2_debian-10_malloctrim ruby-pkg_2.7.2_debian-9_normal ruby-pkg_2.7.2_debian-9_jemalloc ruby-pkg_2.7.2_debian-9_malloctrim ruby-pkg_2.7.2_ubuntu-18.04_normal ruby-pkg_2.7.2_ubuntu-18.04_jemalloc ruby-pkg_2.7.2_ubuntu-18.04_malloctrim ruby-pkg_2.7.2_ubuntu-20.04_normal ruby-pkg_2.7.2_ubuntu-20.04_jemalloc ruby-pkg_2.7.2_ubuntu-20.04_malloctrim ruby-pkg_2.6.6_centos-7_normal ruby-pkg_2.6.6_centos-7_jemalloc ruby-pkg_2.6.6_centos-7_malloctrim ruby-pkg_2.6.6_centos-8_normal ruby-pkg_2.6.6_centos-8_jemalloc ruby-pkg_2.6.6_centos-8_malloctrim ruby-pkg_2.6.6_debian-10_normal ruby-pkg_2.6.6_debian-10_jemalloc ruby-pkg_2.6.6_debian-10_malloctrim ruby-pkg_2.6.6_debian-9_normal ruby-pkg_2.6.6_debian-9_jemalloc ruby-pkg_2.6.6_debian-9_malloctrim ruby-pkg_2.6.6_ubuntu-18.04_normal ruby-pkg_2.6.6_ubuntu-18.04_jemalloc ruby-pkg_2.6.6_ubuntu-18.04_malloctrim ruby-pkg_2.6.6_ubuntu-20.04_normal ruby-pkg_2.6.6_ubuntu-20.04_jemalloc ruby-pkg_2.6.6_ubuntu-20.04_malloctrim ruby-pkg_2.5.8_centos-7_normal ruby-pkg_2.5.8_centos-7_jemalloc ruby-pkg_2.5.8_centos-7_malloctrim ruby-pkg_2.5.8_centos-8_normal ruby-pkg_2.5.8_centos-8_jemalloc ruby-pkg_2.5.8_centos-8_malloctrim ruby-pkg_2.5.8_debian-10_normal ruby-pkg_2.5.8_debian-10_jemalloc ruby-pkg_2.5.8_debian-10_malloctrim ruby-pkg_2.5.8_debian-9_normal ruby-pkg_2.5.8_debian-9_jemalloc ruby-pkg_2.5.8_debian-9_malloctrim ruby-pkg_2.5.8_ubuntu-18.04_normal ruby-pkg_2.5.8_ubuntu-18.04_jemalloc ruby-pkg_2.5.8_ubuntu-18.04_malloctrim ruby-pkg_2.5.8_ubuntu-20.04_normal ruby-pkg_2.5.8_ubuntu-20.04_jemalloc ruby-pkg_2.5.8_ubuntu-20.04_malloctrim
          ARTIFACT_PATH: pkgs

      - name: Download Docker image necessary for publishing
        run: ./internal-scripts/ci-cd/download-artifact.sh
        if: contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Build Docker image utility;')
        env:
          ARTIFACT_NAME: docker-image-utility
          ARTIFACT_PATH: .
      - name: Load Docker image necessary for publishing
        run: ./internal-scripts/ci-cd/load-docker-image.sh
        if: contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Build Docker image utility;')
        env:
          TARBALL: image.tar.zst

      - name: Determine latest release tag
        # Sets environment variable $LATEST_RELEASE_TAG
        run: ./internal-scripts/ci-cd/check-version-numbers-need-changing/determine-latest-release-tag.sh
      - name: Determine Bintray repository package version
        # Sets environment variable $REPO_PACKAGE_VERSION
        run: ./internal-scripts/ci-cd/publish/determine-repo-package-version.sh

      - name: Upload DEBs to repo
        run: ./internal-scripts/ci-cd/publish/publish-debs.sh pkgs/*/*.deb
        env:
          BINTRAY_API_USERNAME: ${{ secrets.BINTRAY_API_USERNAME }}
          BINTRAY_API_KEY: ${{ secrets.BINTRAY_API_KEY }}
          REPO_NAME: fullstaq-ruby-apt
          DRY_RUN: ${{ github.ref != 'refs/heads/main' }}
          IGNORE_EXISTING: true
      - name: Upload RPMs to repo
        run: ./internal-scripts/ci-cd/publish/publish-rpms.sh pkgs/*/*.rpm
        env:
          BINTRAY_API_USERNAME: ${{ secrets.BINTRAY_API_USERNAME }}
          BINTRAY_API_KEY: ${{ secrets.BINTRAY_API_KEY }}
          REPO_NAME: fullstaq-ruby-yum
          DRY_RUN: ${{ github.ref != 'refs/heads/main' }}
          IGNORE_EXISTING: true

      - name: Commit files published to APT repo
        run: ./internal-scripts/ci-cd/publish/commit-published-packages.sh
        env:
          BINTRAY_API_USERNAME: ${{ secrets.BINTRAY_API_USERNAME }}
          BINTRAY_API_KEY: ${{ secrets.BINTRAY_API_KEY }}
          REPO_NAME: fullstaq-ruby-apt
      - name: Commit files published to YUM repo
        run: ./internal-scripts/ci-cd/publish/commit-published-packages.sh
        env:
          BINTRAY_API_USERNAME: ${{ secrets.BINTRAY_API_USERNAME }}
          BINTRAY_API_KEY: ${{ secrets.BINTRAY_API_KEY }}
          REPO_NAME: fullstaq-ruby-yum


  ### Run tests ###



  test_centos_7-2_7-normal:
    name: 'Test [centos-7/2.7/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.7_normal
          ARTIFACT_PATH: mark-normal
  test_centos_7-2_7-jemalloc:
    name: 'Test [centos-7/2.7/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_7-2_7-malloctrim:
    name: 'Test [centos-7/2.7/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_7-2_6-normal:
    name: 'Test [centos-7/2.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.6_normal
          ARTIFACT_PATH: mark-normal
  test_centos_7-2_6-jemalloc:
    name: 'Test [centos-7/2.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_7-2_6-malloctrim:
    name: 'Test [centos-7/2.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_7-2_5-normal:
    name: 'Test [centos-7/2.5/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.5_normal
          ARTIFACT_PATH: mark-normal
  test_centos_7-2_5-jemalloc:
    name: 'Test [centos-7/2.5/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.5_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_7-2_5-malloctrim:
    name: 'Test [centos-7/2.5/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.5_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_7-2_7_2-normal:
    name: 'Test [centos-7/2.7.2/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7.2/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.7.2_normal
          ARTIFACT_PATH: mark-normal
  test_centos_7-2_7_2-jemalloc:
    name: 'Test [centos-7/2.7.2/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7.2/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.7.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_7-2_7_2-malloctrim:
    name: 'Test [centos-7/2.7.2/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7.2/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.7.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_7-2_6_6-normal:
    name: 'Test [centos-7/2.6.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.6.6_normal
          ARTIFACT_PATH: mark-normal
  test_centos_7-2_6_6-jemalloc:
    name: 'Test [centos-7/2.6.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.6.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_7-2_6_6-malloctrim:
    name: 'Test [centos-7/2.6.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.6.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_7-2_5_8-normal:
    name: 'Test [centos-7/2.5.8/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5.8/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.5.8_normal
          ARTIFACT_PATH: mark-normal
  test_centos_7-2_5_8-jemalloc:
    name: 'Test [centos-7/2.5.8/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5.8/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.5.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_7-2_5_8-malloctrim:
    name: 'Test [centos-7/2.5.8/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5.8/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-7"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:7"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-7_2.5.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim

  test_centos_8-2_7-normal:
    name: 'Test [centos-8/2.7/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.7_normal
          ARTIFACT_PATH: mark-normal
  test_centos_8-2_7-jemalloc:
    name: 'Test [centos-8/2.7/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_8-2_7-malloctrim:
    name: 'Test [centos-8/2.7/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_8-2_6-normal:
    name: 'Test [centos-8/2.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.6_normal
          ARTIFACT_PATH: mark-normal
  test_centos_8-2_6-jemalloc:
    name: 'Test [centos-8/2.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_8-2_6-malloctrim:
    name: 'Test [centos-8/2.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_8-2_5-normal:
    name: 'Test [centos-8/2.5/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.5_normal
          ARTIFACT_PATH: mark-normal
  test_centos_8-2_5-jemalloc:
    name: 'Test [centos-8/2.5/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.5_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_8-2_5-malloctrim:
    name: 'Test [centos-8/2.5/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.5_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_8-2_7_2-normal:
    name: 'Test [centos-8/2.7.2/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7.2/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.7.2_normal
          ARTIFACT_PATH: mark-normal
  test_centos_8-2_7_2-jemalloc:
    name: 'Test [centos-8/2.7.2/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7.2/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.7.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_8-2_7_2-malloctrim:
    name: 'Test [centos-8/2.7.2/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7.2/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.7.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_8-2_6_6-normal:
    name: 'Test [centos-8/2.6.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.6.6_normal
          ARTIFACT_PATH: mark-normal
  test_centos_8-2_6_6-jemalloc:
    name: 'Test [centos-8/2.6.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.6.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_8-2_6_6-malloctrim:
    name: 'Test [centos-8/2.6.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.6.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_centos_8-2_5_8-normal:
    name: 'Test [centos-8/2.5.8/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5.8/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.5.8_normal
          ARTIFACT_PATH: mark-normal
  test_centos_8-2_5_8-jemalloc:
    name: 'Test [centos-8/2.5.8/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5.8/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.5.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_centos_8-2_5_8-malloctrim:
    name: 'Test [centos-8/2.5.8/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5.8/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "centos:8"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-centos-8_2.5.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim

  test_debian_10-2_7-normal:
    name: 'Test [debian-10/2.7/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.7_normal
          ARTIFACT_PATH: mark-normal
  test_debian_10-2_7-jemalloc:
    name: 'Test [debian-10/2.7/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_10-2_7-malloctrim:
    name: 'Test [debian-10/2.7/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_10-2_6-normal:
    name: 'Test [debian-10/2.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.6_normal
          ARTIFACT_PATH: mark-normal
  test_debian_10-2_6-jemalloc:
    name: 'Test [debian-10/2.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_10-2_6-malloctrim:
    name: 'Test [debian-10/2.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_10-2_5-normal:
    name: 'Test [debian-10/2.5/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.5_normal
          ARTIFACT_PATH: mark-normal
  test_debian_10-2_5-jemalloc:
    name: 'Test [debian-10/2.5/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.5_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_10-2_5-malloctrim:
    name: 'Test [debian-10/2.5/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.5_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_10-2_7_2-normal:
    name: 'Test [debian-10/2.7.2/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7.2/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.7.2_normal
          ARTIFACT_PATH: mark-normal
  test_debian_10-2_7_2-jemalloc:
    name: 'Test [debian-10/2.7.2/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7.2/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.7.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_10-2_7_2-malloctrim:
    name: 'Test [debian-10/2.7.2/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7.2/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.7.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_10-2_6_6-normal:
    name: 'Test [debian-10/2.6.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.6.6_normal
          ARTIFACT_PATH: mark-normal
  test_debian_10-2_6_6-jemalloc:
    name: 'Test [debian-10/2.6.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.6.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_10-2_6_6-malloctrim:
    name: 'Test [debian-10/2.6.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.6.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_10-2_5_8-normal:
    name: 'Test [debian-10/2.5.8/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5.8/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.5.8_normal
          ARTIFACT_PATH: mark-normal
  test_debian_10-2_5_8-jemalloc:
    name: 'Test [debian-10/2.5.8/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5.8/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.5.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_10-2_5_8-malloctrim:
    name: 'Test [debian-10/2.5.8/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5.8/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-10_2.5.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim

  test_debian_9-2_7-normal:
    name: 'Test [debian-9/2.7/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.7_normal
          ARTIFACT_PATH: mark-normal
  test_debian_9-2_7-jemalloc:
    name: 'Test [debian-9/2.7/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_9-2_7-malloctrim:
    name: 'Test [debian-9/2.7/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_9-2_6-normal:
    name: 'Test [debian-9/2.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.6_normal
          ARTIFACT_PATH: mark-normal
  test_debian_9-2_6-jemalloc:
    name: 'Test [debian-9/2.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_9-2_6-malloctrim:
    name: 'Test [debian-9/2.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_9-2_5-normal:
    name: 'Test [debian-9/2.5/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.5_normal
          ARTIFACT_PATH: mark-normal
  test_debian_9-2_5-jemalloc:
    name: 'Test [debian-9/2.5/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.5_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_9-2_5-malloctrim:
    name: 'Test [debian-9/2.5/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.5_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_9-2_7_2-normal:
    name: 'Test [debian-9/2.7.2/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7.2/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.7.2_normal
          ARTIFACT_PATH: mark-normal
  test_debian_9-2_7_2-jemalloc:
    name: 'Test [debian-9/2.7.2/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7.2/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.7.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_9-2_7_2-malloctrim:
    name: 'Test [debian-9/2.7.2/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7.2/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.7.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_9-2_6_6-normal:
    name: 'Test [debian-9/2.6.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.6.6_normal
          ARTIFACT_PATH: mark-normal
  test_debian_9-2_6_6-jemalloc:
    name: 'Test [debian-9/2.6.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.6.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_9-2_6_6-malloctrim:
    name: 'Test [debian-9/2.6.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.6.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_debian_9-2_5_8-normal:
    name: 'Test [debian-9/2.5.8/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5.8/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.5.8_normal
          ARTIFACT_PATH: mark-normal
  test_debian_9-2_5_8-jemalloc:
    name: 'Test [debian-9/2.5.8/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5.8/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.5.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_debian_9-2_5_8-malloctrim:
    name: 'Test [debian-9/2.5.8/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5.8/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-9"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:9"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-debian-9_2.5.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim

  test_ubuntu_18_04-2_7-normal:
    name: 'Test [ubuntu-18.04/2.7/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.7_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_18_04-2_7-jemalloc:
    name: 'Test [ubuntu-18.04/2.7/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_18_04-2_7-malloctrim:
    name: 'Test [ubuntu-18.04/2.7/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_18_04-2_6-normal:
    name: 'Test [ubuntu-18.04/2.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.6_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_18_04-2_6-jemalloc:
    name: 'Test [ubuntu-18.04/2.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_18_04-2_6-malloctrim:
    name: 'Test [ubuntu-18.04/2.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_18_04-2_5-normal:
    name: 'Test [ubuntu-18.04/2.5/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.5_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_18_04-2_5-jemalloc:
    name: 'Test [ubuntu-18.04/2.5/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.5_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_18_04-2_5-malloctrim:
    name: 'Test [ubuntu-18.04/2.5/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.5_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_18_04-2_7_2-normal:
    name: 'Test [ubuntu-18.04/2.7.2/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7.2/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.7.2_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_18_04-2_7_2-jemalloc:
    name: 'Test [ubuntu-18.04/2.7.2/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7.2/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.7.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_18_04-2_7_2-malloctrim:
    name: 'Test [ubuntu-18.04/2.7.2/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7.2/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.7.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_18_04-2_6_6-normal:
    name: 'Test [ubuntu-18.04/2.6.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.6.6_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_18_04-2_6_6-jemalloc:
    name: 'Test [ubuntu-18.04/2.6.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.6.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_18_04-2_6_6-malloctrim:
    name: 'Test [ubuntu-18.04/2.6.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.6.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_18_04-2_5_8-normal:
    name: 'Test [ubuntu-18.04/2.5.8/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5.8/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.5.8_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_18_04-2_5_8-jemalloc:
    name: 'Test [ubuntu-18.04/2.5.8/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5.8/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.5.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_18_04-2_5_8-malloctrim:
    name: 'Test [ubuntu-18.04/2.5.8/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5.8/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-18.04"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:18.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-18.04_2.5.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim

  test_ubuntu_20_04-2_7-normal:
    name: 'Test [ubuntu-20.04/2.7/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.7_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_20_04-2_7-jemalloc:
    name: 'Test [ubuntu-20.04/2.7/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_20_04-2_7-malloctrim:
    name: 'Test [ubuntu-20.04/2.7/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_20_04-2_6-normal:
    name: 'Test [ubuntu-20.04/2.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.6_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_20_04-2_6-jemalloc:
    name: 'Test [ubuntu-20.04/2.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_20_04-2_6-malloctrim:
    name: 'Test [ubuntu-20.04/2.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_20_04-2_5-normal:
    name: 'Test [ubuntu-20.04/2.5/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.5_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_20_04-2_5-jemalloc:
    name: 'Test [ubuntu-20.04/2.5/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.5_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_20_04-2_5-malloctrim:
    name: 'Test [ubuntu-20.04/2.5/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.5"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.5_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_20_04-2_7_2-normal:
    name: 'Test [ubuntu-20.04/2.7.2/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7.2/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.7.2_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_20_04-2_7_2-jemalloc:
    name: 'Test [ubuntu-20.04/2.7.2/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7.2/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.7.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_20_04-2_7_2-malloctrim:
    name: 'Test [ubuntu-20.04/2.7.2/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7.2/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.7.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.7.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_20_04-2_6_6-normal:
    name: 'Test [ubuntu-20.04/2.6.6/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6.6/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.6.6_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_20_04-2_6_6-jemalloc:
    name: 'Test [ubuntu-20.04/2.6.6/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6.6/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.6.6_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_20_04-2_6_6-malloctrim:
    name: 'Test [ubuntu-20.04/2.6.6/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6.6/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.6.6"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.6.6_malloctrim
          ARTIFACT_PATH: mark-malloctrim
  test_ubuntu_20_04-2_5_8-normal:
    name: 'Test [ubuntu-20.04/2.5.8/normal]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5.8/normal];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.5.8_normal
          ARTIFACT_PATH: mark-normal
  test_ubuntu_20_04-2_5_8-jemalloc:
    name: 'Test [ubuntu-20.04/2.5.8/jemalloc]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5.8/jemalloc];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.5.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
  test_ubuntu_20_04-2_5_8-malloctrim:
    name: 'Test [ubuntu-20.04/2.5.8/malloctrim]'
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
    if: |
      github.ref == 'refs/heads/main'
      && contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5.8/malloctrim];')
    steps:
      - uses: actions/checkout@v2
      - name: Login to Google Cloud
        uses: ./.github/actions/gcloud-login
        with:
          private_key: ${{ secrets.GCLOUD_KEY }}

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "2.5.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://apt.fullstaqruby.org
          YUM_REPO_URL: https://yum.fullstaqruby.org

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-production-ubuntu-20.04_2.5.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim


  ### Finalize ###

  finalize:
    name: Finalize
    runs-on: ubuntu-20.04
    needs:
      - determine_necessary_jobs
      - publish
      - test_centos_7-2_7-normal
      - test_centos_7-2_7-jemalloc
      - test_centos_7-2_7-malloctrim
      - test_centos_7-2_6-normal
      - test_centos_7-2_6-jemalloc
      - test_centos_7-2_6-malloctrim
      - test_centos_7-2_5-normal
      - test_centos_7-2_5-jemalloc
      - test_centos_7-2_5-malloctrim
      - test_centos_7-2_7_2-normal
      - test_centos_7-2_7_2-jemalloc
      - test_centos_7-2_7_2-malloctrim
      - test_centos_7-2_6_6-normal
      - test_centos_7-2_6_6-jemalloc
      - test_centos_7-2_6_6-malloctrim
      - test_centos_7-2_5_8-normal
      - test_centos_7-2_5_8-jemalloc
      - test_centos_7-2_5_8-malloctrim
      - test_centos_8-2_7-normal
      - test_centos_8-2_7-jemalloc
      - test_centos_8-2_7-malloctrim
      - test_centos_8-2_6-normal
      - test_centos_8-2_6-jemalloc
      - test_centos_8-2_6-malloctrim
      - test_centos_8-2_5-normal
      - test_centos_8-2_5-jemalloc
      - test_centos_8-2_5-malloctrim
      - test_centos_8-2_7_2-normal
      - test_centos_8-2_7_2-jemalloc
      - test_centos_8-2_7_2-malloctrim
      - test_centos_8-2_6_6-normal
      - test_centos_8-2_6_6-jemalloc
      - test_centos_8-2_6_6-malloctrim
      - test_centos_8-2_5_8-normal
      - test_centos_8-2_5_8-jemalloc
      - test_centos_8-2_5_8-malloctrim
      - test_debian_10-2_7-normal
      - test_debian_10-2_7-jemalloc
      - test_debian_10-2_7-malloctrim
      - test_debian_10-2_6-normal
      - test_debian_10-2_6-jemalloc
      - test_debian_10-2_6-malloctrim
      - test_debian_10-2_5-normal
      - test_debian_10-2_5-jemalloc
      - test_debian_10-2_5-malloctrim
      - test_debian_10-2_7_2-normal
      - test_debian_10-2_7_2-jemalloc
      - test_debian_10-2_7_2-malloctrim
      - test_debian_10-2_6_6-normal
      - test_debian_10-2_6_6-jemalloc
      - test_debian_10-2_6_6-malloctrim
      - test_debian_10-2_5_8-normal
      - test_debian_10-2_5_8-jemalloc
      - test_debian_10-2_5_8-malloctrim
      - test_debian_9-2_7-normal
      - test_debian_9-2_7-jemalloc
      - test_debian_9-2_7-malloctrim
      - test_debian_9-2_6-normal
      - test_debian_9-2_6-jemalloc
      - test_debian_9-2_6-malloctrim
      - test_debian_9-2_5-normal
      - test_debian_9-2_5-jemalloc
      - test_debian_9-2_5-malloctrim
      - test_debian_9-2_7_2-normal
      - test_debian_9-2_7_2-jemalloc
      - test_debian_9-2_7_2-malloctrim
      - test_debian_9-2_6_6-normal
      - test_debian_9-2_6_6-jemalloc
      - test_debian_9-2_6_6-malloctrim
      - test_debian_9-2_5_8-normal
      - test_debian_9-2_5_8-jemalloc
      - test_debian_9-2_5_8-malloctrim
      - test_ubuntu_18_04-2_7-normal
      - test_ubuntu_18_04-2_7-jemalloc
      - test_ubuntu_18_04-2_7-malloctrim
      - test_ubuntu_18_04-2_6-normal
      - test_ubuntu_18_04-2_6-jemalloc
      - test_ubuntu_18_04-2_6-malloctrim
      - test_ubuntu_18_04-2_5-normal
      - test_ubuntu_18_04-2_5-jemalloc
      - test_ubuntu_18_04-2_5-malloctrim
      - test_ubuntu_18_04-2_7_2-normal
      - test_ubuntu_18_04-2_7_2-jemalloc
      - test_ubuntu_18_04-2_7_2-malloctrim
      - test_ubuntu_18_04-2_6_6-normal
      - test_ubuntu_18_04-2_6_6-jemalloc
      - test_ubuntu_18_04-2_6_6-malloctrim
      - test_ubuntu_18_04-2_5_8-normal
      - test_ubuntu_18_04-2_5_8-jemalloc
      - test_ubuntu_18_04-2_5_8-malloctrim
      - test_ubuntu_20_04-2_7-normal
      - test_ubuntu_20_04-2_7-jemalloc
      - test_ubuntu_20_04-2_7-malloctrim
      - test_ubuntu_20_04-2_6-normal
      - test_ubuntu_20_04-2_6-jemalloc
      - test_ubuntu_20_04-2_6-malloctrim
      - test_ubuntu_20_04-2_5-normal
      - test_ubuntu_20_04-2_5-jemalloc
      - test_ubuntu_20_04-2_5-malloctrim
      - test_ubuntu_20_04-2_7_2-normal
      - test_ubuntu_20_04-2_7_2-jemalloc
      - test_ubuntu_20_04-2_7_2-malloctrim
      - test_ubuntu_20_04-2_6_6-normal
      - test_ubuntu_20_04-2_6_6-jemalloc
      - test_ubuntu_20_04-2_6_6-malloctrim
      - test_ubuntu_20_04-2_5_8-normal
      - test_ubuntu_20_04-2_5_8-jemalloc
      - test_ubuntu_20_04-2_5_8-malloctrim
    if: 'always()'
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0


      ### Check whether dependent jobs failed ###
      # Only trigger next workflow if there are no failures.

      - name: Check whether 'Determine necessary jobs' succeeded
        run: 'false'
        if: needs.determine_necessary_jobs.result != 'success'

      - name: Check whether 'Test [centos-7/2.7/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_7-normal.result != 'success'
          && (needs.test_centos_7-2_7-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7/normal];'))
      - name: Check whether 'Test [centos-7/2.7/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_7-jemalloc.result != 'success'
          && (needs.test_centos_7-2_7-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7/jemalloc];'))
      - name: Check whether 'Test [centos-7/2.7/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_7-malloctrim.result != 'success'
          && (needs.test_centos_7-2_7-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7/malloctrim];'))
      - name: Check whether 'Test [centos-7/2.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_6-normal.result != 'success'
          && (needs.test_centos_7-2_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6/normal];'))
      - name: Check whether 'Test [centos-7/2.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_6-jemalloc.result != 'success'
          && (needs.test_centos_7-2_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6/jemalloc];'))
      - name: Check whether 'Test [centos-7/2.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_6-malloctrim.result != 'success'
          && (needs.test_centos_7-2_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6/malloctrim];'))
      - name: Check whether 'Test [centos-7/2.5/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_5-normal.result != 'success'
          && (needs.test_centos_7-2_5-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5/normal];'))
      - name: Check whether 'Test [centos-7/2.5/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_5-jemalloc.result != 'success'
          && (needs.test_centos_7-2_5-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5/jemalloc];'))
      - name: Check whether 'Test [centos-7/2.5/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_5-malloctrim.result != 'success'
          && (needs.test_centos_7-2_5-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5/malloctrim];'))
      - name: Check whether 'Test [centos-7/2.7.2/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_7_2-normal.result != 'success'
          && (needs.test_centos_7-2_7_2-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7.2/normal];'))
      - name: Check whether 'Test [centos-7/2.7.2/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_7_2-jemalloc.result != 'success'
          && (needs.test_centos_7-2_7_2-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7.2/jemalloc];'))
      - name: Check whether 'Test [centos-7/2.7.2/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_7_2-malloctrim.result != 'success'
          && (needs.test_centos_7-2_7_2-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.7.2/malloctrim];'))
      - name: Check whether 'Test [centos-7/2.6.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_6_6-normal.result != 'success'
          && (needs.test_centos_7-2_6_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6.6/normal];'))
      - name: Check whether 'Test [centos-7/2.6.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_6_6-jemalloc.result != 'success'
          && (needs.test_centos_7-2_6_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6.6/jemalloc];'))
      - name: Check whether 'Test [centos-7/2.6.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_6_6-malloctrim.result != 'success'
          && (needs.test_centos_7-2_6_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.6.6/malloctrim];'))
      - name: Check whether 'Test [centos-7/2.5.8/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_5_8-normal.result != 'success'
          && (needs.test_centos_7-2_5_8-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5.8/normal];'))
      - name: Check whether 'Test [centos-7/2.5.8/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_5_8-jemalloc.result != 'success'
          && (needs.test_centos_7-2_5_8-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5.8/jemalloc];'))
      - name: Check whether 'Test [centos-7/2.5.8/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_7-2_5_8-malloctrim.result != 'success'
          && (needs.test_centos_7-2_5_8-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-7/2.5.8/malloctrim];'))
      - name: Check whether 'Test [centos-8/2.7/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_7-normal.result != 'success'
          && (needs.test_centos_8-2_7-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7/normal];'))
      - name: Check whether 'Test [centos-8/2.7/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_7-jemalloc.result != 'success'
          && (needs.test_centos_8-2_7-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7/jemalloc];'))
      - name: Check whether 'Test [centos-8/2.7/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_7-malloctrim.result != 'success'
          && (needs.test_centos_8-2_7-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7/malloctrim];'))
      - name: Check whether 'Test [centos-8/2.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_6-normal.result != 'success'
          && (needs.test_centos_8-2_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6/normal];'))
      - name: Check whether 'Test [centos-8/2.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_6-jemalloc.result != 'success'
          && (needs.test_centos_8-2_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6/jemalloc];'))
      - name: Check whether 'Test [centos-8/2.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_6-malloctrim.result != 'success'
          && (needs.test_centos_8-2_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6/malloctrim];'))
      - name: Check whether 'Test [centos-8/2.5/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_5-normal.result != 'success'
          && (needs.test_centos_8-2_5-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5/normal];'))
      - name: Check whether 'Test [centos-8/2.5/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_5-jemalloc.result != 'success'
          && (needs.test_centos_8-2_5-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5/jemalloc];'))
      - name: Check whether 'Test [centos-8/2.5/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_5-malloctrim.result != 'success'
          && (needs.test_centos_8-2_5-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5/malloctrim];'))
      - name: Check whether 'Test [centos-8/2.7.2/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_7_2-normal.result != 'success'
          && (needs.test_centos_8-2_7_2-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7.2/normal];'))
      - name: Check whether 'Test [centos-8/2.7.2/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_7_2-jemalloc.result != 'success'
          && (needs.test_centos_8-2_7_2-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7.2/jemalloc];'))
      - name: Check whether 'Test [centos-8/2.7.2/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_7_2-malloctrim.result != 'success'
          && (needs.test_centos_8-2_7_2-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.7.2/malloctrim];'))
      - name: Check whether 'Test [centos-8/2.6.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_6_6-normal.result != 'success'
          && (needs.test_centos_8-2_6_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6.6/normal];'))
      - name: Check whether 'Test [centos-8/2.6.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_6_6-jemalloc.result != 'success'
          && (needs.test_centos_8-2_6_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6.6/jemalloc];'))
      - name: Check whether 'Test [centos-8/2.6.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_6_6-malloctrim.result != 'success'
          && (needs.test_centos_8-2_6_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.6.6/malloctrim];'))
      - name: Check whether 'Test [centos-8/2.5.8/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_5_8-normal.result != 'success'
          && (needs.test_centos_8-2_5_8-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5.8/normal];'))
      - name: Check whether 'Test [centos-8/2.5.8/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_5_8-jemalloc.result != 'success'
          && (needs.test_centos_8-2_5_8-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5.8/jemalloc];'))
      - name: Check whether 'Test [centos-8/2.5.8/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_centos_8-2_5_8-malloctrim.result != 'success'
          && (needs.test_centos_8-2_5_8-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [centos-8/2.5.8/malloctrim];'))
      - name: Check whether 'Test [debian-10/2.7/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_7-normal.result != 'success'
          && (needs.test_debian_10-2_7-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7/normal];'))
      - name: Check whether 'Test [debian-10/2.7/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_7-jemalloc.result != 'success'
          && (needs.test_debian_10-2_7-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7/jemalloc];'))
      - name: Check whether 'Test [debian-10/2.7/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_7-malloctrim.result != 'success'
          && (needs.test_debian_10-2_7-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7/malloctrim];'))
      - name: Check whether 'Test [debian-10/2.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_6-normal.result != 'success'
          && (needs.test_debian_10-2_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6/normal];'))
      - name: Check whether 'Test [debian-10/2.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_6-jemalloc.result != 'success'
          && (needs.test_debian_10-2_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6/jemalloc];'))
      - name: Check whether 'Test [debian-10/2.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_6-malloctrim.result != 'success'
          && (needs.test_debian_10-2_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6/malloctrim];'))
      - name: Check whether 'Test [debian-10/2.5/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_5-normal.result != 'success'
          && (needs.test_debian_10-2_5-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5/normal];'))
      - name: Check whether 'Test [debian-10/2.5/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_5-jemalloc.result != 'success'
          && (needs.test_debian_10-2_5-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5/jemalloc];'))
      - name: Check whether 'Test [debian-10/2.5/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_5-malloctrim.result != 'success'
          && (needs.test_debian_10-2_5-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5/malloctrim];'))
      - name: Check whether 'Test [debian-10/2.7.2/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_7_2-normal.result != 'success'
          && (needs.test_debian_10-2_7_2-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7.2/normal];'))
      - name: Check whether 'Test [debian-10/2.7.2/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_7_2-jemalloc.result != 'success'
          && (needs.test_debian_10-2_7_2-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7.2/jemalloc];'))
      - name: Check whether 'Test [debian-10/2.7.2/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_7_2-malloctrim.result != 'success'
          && (needs.test_debian_10-2_7_2-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.7.2/malloctrim];'))
      - name: Check whether 'Test [debian-10/2.6.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_6_6-normal.result != 'success'
          && (needs.test_debian_10-2_6_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6.6/normal];'))
      - name: Check whether 'Test [debian-10/2.6.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_6_6-jemalloc.result != 'success'
          && (needs.test_debian_10-2_6_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6.6/jemalloc];'))
      - name: Check whether 'Test [debian-10/2.6.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_6_6-malloctrim.result != 'success'
          && (needs.test_debian_10-2_6_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.6.6/malloctrim];'))
      - name: Check whether 'Test [debian-10/2.5.8/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_5_8-normal.result != 'success'
          && (needs.test_debian_10-2_5_8-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5.8/normal];'))
      - name: Check whether 'Test [debian-10/2.5.8/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_5_8-jemalloc.result != 'success'
          && (needs.test_debian_10-2_5_8-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5.8/jemalloc];'))
      - name: Check whether 'Test [debian-10/2.5.8/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_10-2_5_8-malloctrim.result != 'success'
          && (needs.test_debian_10-2_5_8-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-10/2.5.8/malloctrim];'))
      - name: Check whether 'Test [debian-9/2.7/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_7-normal.result != 'success'
          && (needs.test_debian_9-2_7-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7/normal];'))
      - name: Check whether 'Test [debian-9/2.7/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_7-jemalloc.result != 'success'
          && (needs.test_debian_9-2_7-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7/jemalloc];'))
      - name: Check whether 'Test [debian-9/2.7/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_7-malloctrim.result != 'success'
          && (needs.test_debian_9-2_7-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7/malloctrim];'))
      - name: Check whether 'Test [debian-9/2.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_6-normal.result != 'success'
          && (needs.test_debian_9-2_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6/normal];'))
      - name: Check whether 'Test [debian-9/2.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_6-jemalloc.result != 'success'
          && (needs.test_debian_9-2_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6/jemalloc];'))
      - name: Check whether 'Test [debian-9/2.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_6-malloctrim.result != 'success'
          && (needs.test_debian_9-2_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6/malloctrim];'))
      - name: Check whether 'Test [debian-9/2.5/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_5-normal.result != 'success'
          && (needs.test_debian_9-2_5-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5/normal];'))
      - name: Check whether 'Test [debian-9/2.5/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_5-jemalloc.result != 'success'
          && (needs.test_debian_9-2_5-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5/jemalloc];'))
      - name: Check whether 'Test [debian-9/2.5/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_5-malloctrim.result != 'success'
          && (needs.test_debian_9-2_5-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5/malloctrim];'))
      - name: Check whether 'Test [debian-9/2.7.2/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_7_2-normal.result != 'success'
          && (needs.test_debian_9-2_7_2-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7.2/normal];'))
      - name: Check whether 'Test [debian-9/2.7.2/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_7_2-jemalloc.result != 'success'
          && (needs.test_debian_9-2_7_2-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7.2/jemalloc];'))
      - name: Check whether 'Test [debian-9/2.7.2/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_7_2-malloctrim.result != 'success'
          && (needs.test_debian_9-2_7_2-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.7.2/malloctrim];'))
      - name: Check whether 'Test [debian-9/2.6.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_6_6-normal.result != 'success'
          && (needs.test_debian_9-2_6_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6.6/normal];'))
      - name: Check whether 'Test [debian-9/2.6.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_6_6-jemalloc.result != 'success'
          && (needs.test_debian_9-2_6_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6.6/jemalloc];'))
      - name: Check whether 'Test [debian-9/2.6.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_6_6-malloctrim.result != 'success'
          && (needs.test_debian_9-2_6_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.6.6/malloctrim];'))
      - name: Check whether 'Test [debian-9/2.5.8/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_5_8-normal.result != 'success'
          && (needs.test_debian_9-2_5_8-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5.8/normal];'))
      - name: Check whether 'Test [debian-9/2.5.8/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_5_8-jemalloc.result != 'success'
          && (needs.test_debian_9-2_5_8-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5.8/jemalloc];'))
      - name: Check whether 'Test [debian-9/2.5.8/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_debian_9-2_5_8-malloctrim.result != 'success'
          && (needs.test_debian_9-2_5_8-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [debian-9/2.5.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-18.04/2.7/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_7-normal.result != 'success'
          && (needs.test_ubuntu_18_04-2_7-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7/normal];'))
      - name: Check whether 'Test [ubuntu-18.04/2.7/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_7-jemalloc.result != 'success'
          && (needs.test_ubuntu_18_04-2_7-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7/jemalloc];'))
      - name: Check whether 'Test [ubuntu-18.04/2.7/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_7-malloctrim.result != 'success'
          && (needs.test_ubuntu_18_04-2_7-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7/malloctrim];'))
      - name: Check whether 'Test [ubuntu-18.04/2.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_6-normal.result != 'success'
          && (needs.test_ubuntu_18_04-2_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6/normal];'))
      - name: Check whether 'Test [ubuntu-18.04/2.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_6-jemalloc.result != 'success'
          && (needs.test_ubuntu_18_04-2_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6/jemalloc];'))
      - name: Check whether 'Test [ubuntu-18.04/2.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_6-malloctrim.result != 'success'
          && (needs.test_ubuntu_18_04-2_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6/malloctrim];'))
      - name: Check whether 'Test [ubuntu-18.04/2.5/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_5-normal.result != 'success'
          && (needs.test_ubuntu_18_04-2_5-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5/normal];'))
      - name: Check whether 'Test [ubuntu-18.04/2.5/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_5-jemalloc.result != 'success'
          && (needs.test_ubuntu_18_04-2_5-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5/jemalloc];'))
      - name: Check whether 'Test [ubuntu-18.04/2.5/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_5-malloctrim.result != 'success'
          && (needs.test_ubuntu_18_04-2_5-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5/malloctrim];'))
      - name: Check whether 'Test [ubuntu-18.04/2.7.2/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_7_2-normal.result != 'success'
          && (needs.test_ubuntu_18_04-2_7_2-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7.2/normal];'))
      - name: Check whether 'Test [ubuntu-18.04/2.7.2/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_7_2-jemalloc.result != 'success'
          && (needs.test_ubuntu_18_04-2_7_2-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7.2/jemalloc];'))
      - name: Check whether 'Test [ubuntu-18.04/2.7.2/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_7_2-malloctrim.result != 'success'
          && (needs.test_ubuntu_18_04-2_7_2-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.7.2/malloctrim];'))
      - name: Check whether 'Test [ubuntu-18.04/2.6.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_6_6-normal.result != 'success'
          && (needs.test_ubuntu_18_04-2_6_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6.6/normal];'))
      - name: Check whether 'Test [ubuntu-18.04/2.6.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_6_6-jemalloc.result != 'success'
          && (needs.test_ubuntu_18_04-2_6_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6.6/jemalloc];'))
      - name: Check whether 'Test [ubuntu-18.04/2.6.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_6_6-malloctrim.result != 'success'
          && (needs.test_ubuntu_18_04-2_6_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.6.6/malloctrim];'))
      - name: Check whether 'Test [ubuntu-18.04/2.5.8/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_5_8-normal.result != 'success'
          && (needs.test_ubuntu_18_04-2_5_8-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5.8/normal];'))
      - name: Check whether 'Test [ubuntu-18.04/2.5.8/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_5_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_18_04-2_5_8-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-18.04/2.5.8/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_18_04-2_5_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_18_04-2_5_8-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-18.04/2.5.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/2.7/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_7-normal.result != 'success'
          && (needs.test_ubuntu_20_04-2_7-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/2.7/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_7-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-2_7-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/2.7/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_7-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-2_7-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/2.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_6-normal.result != 'success'
          && (needs.test_ubuntu_20_04-2_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/2.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_6-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-2_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/2.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_6-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-2_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/2.5/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_5-normal.result != 'success'
          && (needs.test_ubuntu_20_04-2_5-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/2.5/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_5-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-2_5-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/2.5/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_5-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-2_5-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/2.7.2/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_7_2-normal.result != 'success'
          && (needs.test_ubuntu_20_04-2_7_2-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7.2/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/2.7.2/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_7_2-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-2_7_2-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7.2/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/2.7.2/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_7_2-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-2_7_2-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.7.2/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/2.6.6/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_6_6-normal.result != 'success'
          && (needs.test_ubuntu_20_04-2_6_6-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6.6/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/2.6.6/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_6_6-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-2_6_6-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6.6/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/2.6.6/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_6_6-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-2_6_6-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.6.6/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/2.5.8/normal]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_5_8-normal.result != 'success'
          && (needs.test_ubuntu_20_04-2_5_8-normal.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5.8/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/2.5.8/jemalloc]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_5_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-2_5_8-jemalloc.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/2.5.8/malloctrim]' did not fail
        run: 'false'
        if: |
          github.ref == 'refs/heads/main'
          && needs.test_ubuntu_20_04-2_5_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-2_5_8-malloctrim.result != 'skipped'
            || contains(needs.determine_necessary_jobs.outputs.necessary_jobs, ';Test against production repo [ubuntu-20.04/2.5.8/malloctrim];'))


      ### Create Git tag ###

      - name: Determine latest release version
        # Sets environment variable $LATEST_RELEASE_TAG
        run: ./internal-scripts/ci-cd/check-version-numbers-need-changing/determine-latest-release-tag.sh

      - name: Determine next epic version
        # Sets environment variable $NEXT_RELEASE_VERSION
        run: ./internal-scripts/ci-cd/create-git-tag/determine-next-epic-version.sh

      - name: Create Git tag
        run: git tag epic-${{ env.NEXT_RELEASE_VERSION }}

      - name: Push Git tag
        if: github.ref == 'refs/heads/main'
        run: git push origin epic-${{ env.NEXT_RELEASE_VERSION }}


      ### Update own check status ###

      - name: Mark check as 'success'
        uses: LouisBrunner/checks-action@v1.1.0
        if: 'github.event.inputs.check_id && success()'
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          check_id: ${{ github.event.inputs.check_id }}
          conclusion: success

      - name: Mark check as 'failure'
        uses: LouisBrunner/checks-action@v1.1.0
        if: 'github.event.inputs.check_id && failure()'
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          check_id: ${{ github.event.inputs.check_id }}
          conclusion: failure

      - name: Mark check as 'cancelled'
        uses: LouisBrunner/checks-action@v1.1.0
        if: 'github.event.inputs.check_id && cancelled()'
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          check_id: ${{ github.event.inputs.check_id }}
          conclusion: cancelled
