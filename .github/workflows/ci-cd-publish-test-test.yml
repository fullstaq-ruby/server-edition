# WARNING: DO NOT EDIT THIS FILE!!!
#
# This file is autogenerated from .github/workflows/ci-cd-publish-test-test.yml.erb
# by ./internal-scripts/generate-ci-cd-yaml.rb.
# Please edit the .erb file instead, then regenerate YAML
# by running that script.
#
# TIP: run this on your development machine to ensure generate-ci-cd-yaml.rb
# is run automatically as a Git pre-commit hook:
#
#   git config core.hooksPath .githooks

name: 'CI/CD: publish & test against test repos'

on:
  workflow_call:
    inputs:
      ci_artifacts_run_number:
        required: true
        type: string
      necessary_jobs:
        required: true
        type: string

env:
  CI_ARTIFACTS_RUN_NUMBER: ${{ inputs.ci_artifacts_run_number || github.run_number }}

jobs:
  ### Publish ###

  publish:
    name: Publish packages
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    permissions:
      id-token: write
      packages: read
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Clean disk space
        run: ./internal-scripts/ci-cd/publish/clean-disk-space.sh
      - uses: azure/login@v2
        with:
          tenant-id: ${{ vars.AZURE_TENANT_ID }}
          client-id: ${{ vars.AZURE_CLIENT_ID }}
          subscription-id: ${{ vars.AZURE_SUBSCRIPTION_ID }}
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'
      - name: Login to Github Container Registry
        run: docker login ghcr.io -u ${{ github.actor }} --password-stdin <<<"$GITHUB_TOKEN"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Download artifacts
        run: ./internal-scripts/ci-cd/download-artifacts.sh
        env:
          ARTIFACT_NAMES: |
            common-deb
            common-rpm
            rbenv-deb
            rbenv-rpm
            ruby-pkg_3.4_centos-8_normal ruby-pkg_3.4_centos-8_jemalloc ruby-pkg_3.4_centos-8_malloctrim ruby-pkg_3.3_centos-8_normal ruby-pkg_3.3_centos-8_jemalloc ruby-pkg_3.3_centos-8_malloctrim ruby-pkg_3.2_centos-8_normal ruby-pkg_3.2_centos-8_jemalloc ruby-pkg_3.2_centos-8_malloctrim ruby-pkg_3.4.3_centos-8_normal ruby-pkg_3.4.3_centos-8_jemalloc ruby-pkg_3.4.3_centos-8_malloctrim ruby-pkg_3.3.8_centos-8_normal ruby-pkg_3.3.8_centos-8_jemalloc ruby-pkg_3.3.8_centos-8_malloctrim ruby-pkg_3.2.8_centos-8_normal ruby-pkg_3.2.8_centos-8_jemalloc ruby-pkg_3.2.8_centos-8_malloctrim ruby-pkg_3.4_debian-10_normal ruby-pkg_3.4_debian-10_jemalloc ruby-pkg_3.4_debian-10_malloctrim ruby-pkg_3.3_debian-10_normal ruby-pkg_3.3_debian-10_jemalloc ruby-pkg_3.3_debian-10_malloctrim ruby-pkg_3.2_debian-10_normal ruby-pkg_3.2_debian-10_jemalloc ruby-pkg_3.2_debian-10_malloctrim ruby-pkg_3.1_debian-10_normal ruby-pkg_3.1_debian-10_jemalloc ruby-pkg_3.1_debian-10_malloctrim ruby-pkg_3.4.3_debian-10_normal ruby-pkg_3.4.3_debian-10_jemalloc ruby-pkg_3.4.3_debian-10_malloctrim ruby-pkg_3.3.8_debian-10_normal ruby-pkg_3.3.8_debian-10_jemalloc ruby-pkg_3.3.8_debian-10_malloctrim ruby-pkg_3.2.8_debian-10_normal ruby-pkg_3.2.8_debian-10_jemalloc ruby-pkg_3.2.8_debian-10_malloctrim ruby-pkg_3.1.7_debian-10_normal ruby-pkg_3.1.7_debian-10_jemalloc ruby-pkg_3.1.7_debian-10_malloctrim ruby-pkg_3.4_debian-11_normal ruby-pkg_3.4_debian-11_jemalloc ruby-pkg_3.4_debian-11_malloctrim ruby-pkg_3.3_debian-11_normal ruby-pkg_3.3_debian-11_jemalloc ruby-pkg_3.3_debian-11_malloctrim ruby-pkg_3.2_debian-11_normal ruby-pkg_3.2_debian-11_jemalloc ruby-pkg_3.2_debian-11_malloctrim ruby-pkg_3.1_debian-11_normal ruby-pkg_3.1_debian-11_jemalloc ruby-pkg_3.1_debian-11_malloctrim ruby-pkg_3.4.3_debian-11_normal ruby-pkg_3.4.3_debian-11_jemalloc ruby-pkg_3.4.3_debian-11_malloctrim ruby-pkg_3.3.8_debian-11_normal ruby-pkg_3.3.8_debian-11_jemalloc ruby-pkg_3.3.8_debian-11_malloctrim ruby-pkg_3.2.8_debian-11_normal ruby-pkg_3.2.8_debian-11_jemalloc ruby-pkg_3.2.8_debian-11_malloctrim ruby-pkg_3.1.7_debian-11_normal ruby-pkg_3.1.7_debian-11_jemalloc ruby-pkg_3.1.7_debian-11_malloctrim ruby-pkg_3.4_debian-12_normal ruby-pkg_3.4_debian-12_jemalloc ruby-pkg_3.4_debian-12_malloctrim ruby-pkg_3.3_debian-12_normal ruby-pkg_3.3_debian-12_jemalloc ruby-pkg_3.3_debian-12_malloctrim ruby-pkg_3.2_debian-12_normal ruby-pkg_3.2_debian-12_jemalloc ruby-pkg_3.2_debian-12_malloctrim ruby-pkg_3.4.3_debian-12_normal ruby-pkg_3.4.3_debian-12_jemalloc ruby-pkg_3.4.3_debian-12_malloctrim ruby-pkg_3.3.8_debian-12_normal ruby-pkg_3.3.8_debian-12_jemalloc ruby-pkg_3.3.8_debian-12_malloctrim ruby-pkg_3.2.8_debian-12_normal ruby-pkg_3.2.8_debian-12_jemalloc ruby-pkg_3.2.8_debian-12_malloctrim ruby-pkg_3.4_el-9_normal ruby-pkg_3.4_el-9_jemalloc ruby-pkg_3.4_el-9_malloctrim ruby-pkg_3.3_el-9_normal ruby-pkg_3.3_el-9_jemalloc ruby-pkg_3.3_el-9_malloctrim ruby-pkg_3.2_el-9_normal ruby-pkg_3.2_el-9_jemalloc ruby-pkg_3.2_el-9_malloctrim ruby-pkg_3.1_el-9_normal ruby-pkg_3.1_el-9_jemalloc ruby-pkg_3.1_el-9_malloctrim ruby-pkg_3.4.3_el-9_normal ruby-pkg_3.4.3_el-9_jemalloc ruby-pkg_3.4.3_el-9_malloctrim ruby-pkg_3.3.8_el-9_normal ruby-pkg_3.3.8_el-9_jemalloc ruby-pkg_3.3.8_el-9_malloctrim ruby-pkg_3.2.8_el-9_normal ruby-pkg_3.2.8_el-9_jemalloc ruby-pkg_3.2.8_el-9_malloctrim ruby-pkg_3.1.7_el-9_normal ruby-pkg_3.1.7_el-9_jemalloc ruby-pkg_3.1.7_el-9_malloctrim ruby-pkg_3.4_ubuntu-20.04_normal ruby-pkg_3.4_ubuntu-20.04_jemalloc ruby-pkg_3.4_ubuntu-20.04_malloctrim ruby-pkg_3.3_ubuntu-20.04_normal ruby-pkg_3.3_ubuntu-20.04_jemalloc ruby-pkg_3.3_ubuntu-20.04_malloctrim ruby-pkg_3.2_ubuntu-20.04_normal ruby-pkg_3.2_ubuntu-20.04_jemalloc ruby-pkg_3.2_ubuntu-20.04_malloctrim ruby-pkg_3.1_ubuntu-20.04_normal ruby-pkg_3.1_ubuntu-20.04_jemalloc ruby-pkg_3.1_ubuntu-20.04_malloctrim ruby-pkg_3.4.3_ubuntu-20.04_normal ruby-pkg_3.4.3_ubuntu-20.04_jemalloc ruby-pkg_3.4.3_ubuntu-20.04_malloctrim ruby-pkg_3.3.8_ubuntu-20.04_normal ruby-pkg_3.3.8_ubuntu-20.04_jemalloc ruby-pkg_3.3.8_ubuntu-20.04_malloctrim ruby-pkg_3.2.8_ubuntu-20.04_normal ruby-pkg_3.2.8_ubuntu-20.04_jemalloc ruby-pkg_3.2.8_ubuntu-20.04_malloctrim ruby-pkg_3.1.7_ubuntu-20.04_normal ruby-pkg_3.1.7_ubuntu-20.04_jemalloc ruby-pkg_3.1.7_ubuntu-20.04_malloctrim ruby-pkg_3.4_ubuntu-22.04_normal ruby-pkg_3.4_ubuntu-22.04_jemalloc ruby-pkg_3.4_ubuntu-22.04_malloctrim ruby-pkg_3.3_ubuntu-22.04_normal ruby-pkg_3.3_ubuntu-22.04_jemalloc ruby-pkg_3.3_ubuntu-22.04_malloctrim ruby-pkg_3.2_ubuntu-22.04_normal ruby-pkg_3.2_ubuntu-22.04_jemalloc ruby-pkg_3.2_ubuntu-22.04_malloctrim ruby-pkg_3.1_ubuntu-22.04_normal ruby-pkg_3.1_ubuntu-22.04_jemalloc ruby-pkg_3.1_ubuntu-22.04_malloctrim ruby-pkg_3.4.3_ubuntu-22.04_normal ruby-pkg_3.4.3_ubuntu-22.04_jemalloc ruby-pkg_3.4.3_ubuntu-22.04_malloctrim ruby-pkg_3.3.8_ubuntu-22.04_normal ruby-pkg_3.3.8_ubuntu-22.04_jemalloc ruby-pkg_3.3.8_ubuntu-22.04_malloctrim ruby-pkg_3.2.8_ubuntu-22.04_normal ruby-pkg_3.2.8_ubuntu-22.04_jemalloc ruby-pkg_3.2.8_ubuntu-22.04_malloctrim ruby-pkg_3.1.7_ubuntu-22.04_normal ruby-pkg_3.1.7_ubuntu-22.04_jemalloc ruby-pkg_3.1.7_ubuntu-22.04_malloctrim ruby-pkg_3.4_ubuntu-24.04_normal ruby-pkg_3.4_ubuntu-24.04_jemalloc ruby-pkg_3.4_ubuntu-24.04_malloctrim ruby-pkg_3.3_ubuntu-24.04_normal ruby-pkg_3.3_ubuntu-24.04_jemalloc ruby-pkg_3.3_ubuntu-24.04_malloctrim ruby-pkg_3.2_ubuntu-24.04_normal ruby-pkg_3.2_ubuntu-24.04_jemalloc ruby-pkg_3.2_ubuntu-24.04_malloctrim ruby-pkg_3.1_ubuntu-24.04_normal ruby-pkg_3.1_ubuntu-24.04_jemalloc ruby-pkg_3.1_ubuntu-24.04_malloctrim ruby-pkg_3.4.3_ubuntu-24.04_normal ruby-pkg_3.4.3_ubuntu-24.04_jemalloc ruby-pkg_3.4.3_ubuntu-24.04_malloctrim ruby-pkg_3.3.8_ubuntu-24.04_normal ruby-pkg_3.3.8_ubuntu-24.04_jemalloc ruby-pkg_3.3.8_ubuntu-24.04_malloctrim ruby-pkg_3.2.8_ubuntu-24.04_normal ruby-pkg_3.2.8_ubuntu-24.04_jemalloc ruby-pkg_3.2.8_ubuntu-24.04_malloctrim ruby-pkg_3.1.7_ubuntu-24.04_normal ruby-pkg_3.1.7_ubuntu-24.04_jemalloc ruby-pkg_3.1.7_ubuntu-24.04_malloctrim
          ARTIFACT_PATH: pkgs
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

      - name: Download Docker image necessary for publishing
        run: ./internal-scripts/ci-cd/download-artifact.sh
        if: contains(inputs.necessary_jobs, ';Use locally-built Docker image utility;')
        env:
          ARTIFACT_NAME: docker-image-utility
          ARTIFACT_PATH: .
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}
      - name: Load Docker image necessary for publishing
        run: ./internal-scripts/ci-cd/load-docker-image.sh
        if: contains(inputs.necessary_jobs, ';Use locally-built Docker image utility;')
        env:
          TARBALL: image.tar.zst
      - name: Install Aptly
        run: ./internal-scripts/ci-cd/publish/install-aptly.sh

      - name: Determine latest release tag
        # Sets environment variable $LATEST_RELEASE_TAG
        run: ./internal-scripts/ci-cd/check-version-numbers-need-changing/determine-latest-release-tag.sh

      - name: Upload DEBs to repo
        run: ./internal-scripts/ci-cd/publish/publish-debs.rb pkgs/*/*.deb
        env:
          PRODUCTION_REPO_BUCKET_NAME: fsruby-server-edition-apt-repo
          CI_ARTIFACTS_BUCKET_NAME: ${{ vars.CI_ARTIFACTS_BUCKET }}
          TESTING: true
          OVERWRITE_EXISTING: false
          CLEANUP: true

      - name: Upload RPMs to repo
        run: ./internal-scripts/ci-cd/publish/publish-rpms.rb pkgs/*/*.rpm
        env:
          PRODUCTION_REPO_BUCKET_NAME: fsruby-server-edition-yum-repo
          CI_ARTIFACTS_BUCKET_NAME: ${{ vars.CI_ARTIFACTS_BUCKET }}
          TESTING: true
          OVERWRITE_EXISTING: false


  ### Run tests ###



  test_centos_8-3_4-normal:
    name: 'Test [centos-8/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_4-jemalloc:
    name: 'Test [centos-8/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_4-malloctrim:
    name: 'Test [centos-8/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_3-normal:
    name: 'Test [centos-8/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_3-jemalloc:
    name: 'Test [centos-8/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_3-malloctrim:
    name: 'Test [centos-8/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_2-normal:
    name: 'Test [centos-8/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_2-jemalloc:
    name: 'Test [centos-8/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_2-malloctrim:
    name: 'Test [centos-8/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_4_3-normal:
    name: 'Test [centos-8/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_4_3-jemalloc:
    name: 'Test [centos-8/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_4_3-malloctrim:
    name: 'Test [centos-8/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_3_8-normal:
    name: 'Test [centos-8/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_3_8-jemalloc:
    name: 'Test [centos-8/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_3_8-malloctrim:
    name: 'Test [centos-8/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_2_8-normal:
    name: 'Test [centos-8/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_2_8-jemalloc:
    name: 'Test [centos-8/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_centos_8-3_2_8-malloctrim:
    name: 'Test [centos-8/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "centos-8"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:8"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-centos-8_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}


  test_debian_10-3_4-normal:
    name: 'Test [debian-10/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_4-jemalloc:
    name: 'Test [debian-10/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_4-malloctrim:
    name: 'Test [debian-10/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_3-normal:
    name: 'Test [debian-10/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_3-jemalloc:
    name: 'Test [debian-10/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_3-malloctrim:
    name: 'Test [debian-10/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_2-normal:
    name: 'Test [debian-10/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_2-jemalloc:
    name: 'Test [debian-10/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_2-malloctrim:
    name: 'Test [debian-10/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_1-normal:
    name: 'Test [debian-10/3.1/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.1_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_1-jemalloc:
    name: 'Test [debian-10/3.1/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.1_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_1-malloctrim:
    name: 'Test [debian-10/3.1/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.1_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_4_3-normal:
    name: 'Test [debian-10/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_4_3-jemalloc:
    name: 'Test [debian-10/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_4_3-malloctrim:
    name: 'Test [debian-10/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_3_8-normal:
    name: 'Test [debian-10/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_3_8-jemalloc:
    name: 'Test [debian-10/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_3_8-malloctrim:
    name: 'Test [debian-10/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_2_8-normal:
    name: 'Test [debian-10/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_2_8-jemalloc:
    name: 'Test [debian-10/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_2_8-malloctrim:
    name: 'Test [debian-10/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_1_7-normal:
    name: 'Test [debian-10/3.1.7/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1.7/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.1.7_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_1_7-jemalloc:
    name: 'Test [debian-10/3.1.7/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1.7/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.1.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_10-3_1_7-malloctrim:
    name: 'Test [debian-10/3.1.7/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1.7/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-10"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:10"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-10_3.1.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}


  test_debian_11-3_4-normal:
    name: 'Test [debian-11/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_4-jemalloc:
    name: 'Test [debian-11/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_4-malloctrim:
    name: 'Test [debian-11/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_3-normal:
    name: 'Test [debian-11/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_3-jemalloc:
    name: 'Test [debian-11/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_3-malloctrim:
    name: 'Test [debian-11/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_2-normal:
    name: 'Test [debian-11/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_2-jemalloc:
    name: 'Test [debian-11/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_2-malloctrim:
    name: 'Test [debian-11/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_1-normal:
    name: 'Test [debian-11/3.1/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.1_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_1-jemalloc:
    name: 'Test [debian-11/3.1/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.1_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_1-malloctrim:
    name: 'Test [debian-11/3.1/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.1_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_4_3-normal:
    name: 'Test [debian-11/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_4_3-jemalloc:
    name: 'Test [debian-11/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_4_3-malloctrim:
    name: 'Test [debian-11/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_3_8-normal:
    name: 'Test [debian-11/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_3_8-jemalloc:
    name: 'Test [debian-11/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_3_8-malloctrim:
    name: 'Test [debian-11/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_2_8-normal:
    name: 'Test [debian-11/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_2_8-jemalloc:
    name: 'Test [debian-11/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_2_8-malloctrim:
    name: 'Test [debian-11/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_1_7-normal:
    name: 'Test [debian-11/3.1.7/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1.7/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.1.7_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_1_7-jemalloc:
    name: 'Test [debian-11/3.1.7/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1.7/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.1.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_11-3_1_7-malloctrim:
    name: 'Test [debian-11/3.1.7/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1.7/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-11"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:11"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-11_3.1.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}


  test_debian_12-3_4-normal:
    name: 'Test [debian-12/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_4-jemalloc:
    name: 'Test [debian-12/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_4-malloctrim:
    name: 'Test [debian-12/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_3-normal:
    name: 'Test [debian-12/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_3-jemalloc:
    name: 'Test [debian-12/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_3-malloctrim:
    name: 'Test [debian-12/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_2-normal:
    name: 'Test [debian-12/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_2-jemalloc:
    name: 'Test [debian-12/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_2-malloctrim:
    name: 'Test [debian-12/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_4_3-normal:
    name: 'Test [debian-12/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_4_3-jemalloc:
    name: 'Test [debian-12/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_4_3-malloctrim:
    name: 'Test [debian-12/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_3_8-normal:
    name: 'Test [debian-12/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_3_8-jemalloc:
    name: 'Test [debian-12/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_3_8-malloctrim:
    name: 'Test [debian-12/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_2_8-normal:
    name: 'Test [debian-12/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_2_8-jemalloc:
    name: 'Test [debian-12/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_debian_12-3_2_8-malloctrim:
    name: 'Test [debian-12/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "debian-12"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "debian:12"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-debian-12_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}


  test_el_9-3_4-normal:
    name: 'Test [el-9/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_4-jemalloc:
    name: 'Test [el-9/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_4-malloctrim:
    name: 'Test [el-9/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_3-normal:
    name: 'Test [el-9/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_3-jemalloc:
    name: 'Test [el-9/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_3-malloctrim:
    name: 'Test [el-9/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_2-normal:
    name: 'Test [el-9/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_2-jemalloc:
    name: 'Test [el-9/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_2-malloctrim:
    name: 'Test [el-9/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_1-normal:
    name: 'Test [el-9/3.1/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.1_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_1-jemalloc:
    name: 'Test [el-9/3.1/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.1_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_1-malloctrim:
    name: 'Test [el-9/3.1/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.1_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_4_3-normal:
    name: 'Test [el-9/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_4_3-jemalloc:
    name: 'Test [el-9/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_4_3-malloctrim:
    name: 'Test [el-9/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_3_8-normal:
    name: 'Test [el-9/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_3_8-jemalloc:
    name: 'Test [el-9/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_3_8-malloctrim:
    name: 'Test [el-9/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_2_8-normal:
    name: 'Test [el-9/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_2_8-jemalloc:
    name: 'Test [el-9/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_2_8-malloctrim:
    name: 'Test [el-9/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_1_7-normal:
    name: 'Test [el-9/3.1.7/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1.7/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.1.7_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_1_7-jemalloc:
    name: 'Test [el-9/3.1.7/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1.7/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.1.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_el_9-3_1_7-malloctrim:
    name: 'Test [el-9/3.1.7/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1.7/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "el-9"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "RPM"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "rockylinux:9"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-el-9_3.1.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}


  test_ubuntu_20_04-3_4-normal:
    name: 'Test [ubuntu-20.04/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_4-jemalloc:
    name: 'Test [ubuntu-20.04/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_4-malloctrim:
    name: 'Test [ubuntu-20.04/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_3-normal:
    name: 'Test [ubuntu-20.04/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_3-jemalloc:
    name: 'Test [ubuntu-20.04/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_3-malloctrim:
    name: 'Test [ubuntu-20.04/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_2-normal:
    name: 'Test [ubuntu-20.04/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_2-jemalloc:
    name: 'Test [ubuntu-20.04/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_2-malloctrim:
    name: 'Test [ubuntu-20.04/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_1-normal:
    name: 'Test [ubuntu-20.04/3.1/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.1_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_1-jemalloc:
    name: 'Test [ubuntu-20.04/3.1/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.1_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_1-malloctrim:
    name: 'Test [ubuntu-20.04/3.1/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.1_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_4_3-normal:
    name: 'Test [ubuntu-20.04/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_4_3-jemalloc:
    name: 'Test [ubuntu-20.04/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_4_3-malloctrim:
    name: 'Test [ubuntu-20.04/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_3_8-normal:
    name: 'Test [ubuntu-20.04/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_3_8-jemalloc:
    name: 'Test [ubuntu-20.04/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_3_8-malloctrim:
    name: 'Test [ubuntu-20.04/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_2_8-normal:
    name: 'Test [ubuntu-20.04/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_2_8-jemalloc:
    name: 'Test [ubuntu-20.04/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_2_8-malloctrim:
    name: 'Test [ubuntu-20.04/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_1_7-normal:
    name: 'Test [ubuntu-20.04/3.1.7/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1.7/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.1.7_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_1_7-jemalloc:
    name: 'Test [ubuntu-20.04/3.1.7/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1.7/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.1.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_20_04-3_1_7-malloctrim:
    name: 'Test [ubuntu-20.04/3.1.7/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1.7/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-20.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:20.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-20.04_3.1.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}


  test_ubuntu_22_04-3_4-normal:
    name: 'Test [ubuntu-22.04/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_4-jemalloc:
    name: 'Test [ubuntu-22.04/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_4-malloctrim:
    name: 'Test [ubuntu-22.04/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_3-normal:
    name: 'Test [ubuntu-22.04/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_3-jemalloc:
    name: 'Test [ubuntu-22.04/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_3-malloctrim:
    name: 'Test [ubuntu-22.04/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_2-normal:
    name: 'Test [ubuntu-22.04/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_2-jemalloc:
    name: 'Test [ubuntu-22.04/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_2-malloctrim:
    name: 'Test [ubuntu-22.04/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_1-normal:
    name: 'Test [ubuntu-22.04/3.1/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.1_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_1-jemalloc:
    name: 'Test [ubuntu-22.04/3.1/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.1_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_1-malloctrim:
    name: 'Test [ubuntu-22.04/3.1/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.1_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_4_3-normal:
    name: 'Test [ubuntu-22.04/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_4_3-jemalloc:
    name: 'Test [ubuntu-22.04/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_4_3-malloctrim:
    name: 'Test [ubuntu-22.04/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_3_8-normal:
    name: 'Test [ubuntu-22.04/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_3_8-jemalloc:
    name: 'Test [ubuntu-22.04/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_3_8-malloctrim:
    name: 'Test [ubuntu-22.04/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_2_8-normal:
    name: 'Test [ubuntu-22.04/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_2_8-jemalloc:
    name: 'Test [ubuntu-22.04/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_2_8-malloctrim:
    name: 'Test [ubuntu-22.04/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_1_7-normal:
    name: 'Test [ubuntu-22.04/3.1.7/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1.7/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.1.7_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_1_7-jemalloc:
    name: 'Test [ubuntu-22.04/3.1.7/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1.7/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.1.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_22_04-3_1_7-malloctrim:
    name: 'Test [ubuntu-22.04/3.1.7/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1.7/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-22.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:22.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-22.04_3.1.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}


  test_ubuntu_24_04-3_4-normal:
    name: 'Test [ubuntu-24.04/3.4/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.4_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_4-jemalloc:
    name: 'Test [ubuntu-24.04/3.4/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.4_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_4-malloctrim:
    name: 'Test [ubuntu-24.04/3.4/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.4"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.4_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_3-normal:
    name: 'Test [ubuntu-24.04/3.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_3-jemalloc:
    name: 'Test [ubuntu-24.04/3.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_3-malloctrim:
    name: 'Test [ubuntu-24.04/3.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_2-normal:
    name: 'Test [ubuntu-24.04/3.2/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.2_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_2-jemalloc:
    name: 'Test [ubuntu-24.04/3.2/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.2_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_2-malloctrim:
    name: 'Test [ubuntu-24.04/3.2/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.2"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.2_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_1-normal:
    name: 'Test [ubuntu-24.04/3.1/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.1_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_1-jemalloc:
    name: 'Test [ubuntu-24.04/3.1/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.1_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_1-malloctrim:
    name: 'Test [ubuntu-24.04/3.1/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.1"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.1_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_4_3-normal:
    name: 'Test [ubuntu-24.04/3.4.3/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4.3/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.4.3_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_4_3-jemalloc:
    name: 'Test [ubuntu-24.04/3.4.3/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4.3/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.4.3_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_4_3-malloctrim:
    name: 'Test [ubuntu-24.04/3.4.3/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4.3/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.4.3"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.4.3_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_3_8-normal:
    name: 'Test [ubuntu-24.04/3.3.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.3.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_3_8-jemalloc:
    name: 'Test [ubuntu-24.04/3.3.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.3.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_3_8-malloctrim:
    name: 'Test [ubuntu-24.04/3.3.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.3.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.3.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_2_8-normal:
    name: 'Test [ubuntu-24.04/3.2.8/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2.8/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.2.8_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_2_8-jemalloc:
    name: 'Test [ubuntu-24.04/3.2.8/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2.8/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.2.8_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_2_8-malloctrim:
    name: 'Test [ubuntu-24.04/3.2.8/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2.8/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.2.8"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.2.8_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_1_7-normal:
    name: 'Test [ubuntu-24.04/3.1.7/normal]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1.7/normal];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "normal"
          VARIANT_PACKAGE_SUFFIX: ""
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-normal && touch mark-normal/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.1.7_normal
          ARTIFACT_PATH: mark-normal
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_1_7-jemalloc:
    name: 'Test [ubuntu-24.04/3.1.7/jemalloc]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1.7/jemalloc];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "jemalloc"
          VARIANT_PACKAGE_SUFFIX: "-jemalloc"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-jemalloc && touch mark-jemalloc/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.1.7_jemalloc
          ARTIFACT_PATH: mark-jemalloc
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}

  test_ubuntu_24_04-3_1_7-malloctrim:
    name: 'Test [ubuntu-24.04/3.1.7/malloctrim]'
    needs:
      - publish
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 30
    if: contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1.7/malloctrim];')
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: google-github-actions/auth@v2
        with:
          project_id: ${{ vars.GCLOUD_PROJECT_ID }}
          workload_identity_provider: projects/${{ vars.GCLOUD_PROJECT_NUM }}/locations/global/workloadIdentityPools/github-ci-test/providers/github-ci-test
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          version: '>= 363.0.0'

      - name: Run tests
        run: ./internal-scripts/ci-cd/test-packages/run-tests.sh
        env:
          DISTRIBUTION_NAME: "ubuntu-24.04"
          RUBY_PACKAGE_ID: "3.1.7"
          PACKAGE_FORMAT: "DEB"
          VARIANT_NAME: "malloctrim"
          VARIANT_PACKAGE_SUFFIX: "-malloctrim"
          TEST_IMAGE_NAME: "ubuntu:24.04"
          APT_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/apt-repo/versions/singleton/public
          YUM_REPO_URL: https://storage.googleapis.com/${{ vars.CI_ARTIFACTS_BUCKET }}/${{ env.CI_ARTIFACTS_RUN_NUMBER }}/yum-repo/versions/singleton/public

      - name: Create mark file
        run: mkdir mark-malloctrim && touch mark-malloctrim/done.txt
      - name: Mark job as done
        run: ./internal-scripts/ci-cd/upload-artifact.sh
        env:
          ARTIFACT_NAME: tested-against-test-ubuntu-24.04_3.1.7_malloctrim
          ARTIFACT_PATH: mark-malloctrim
          CI_ARTIFACTS_BUCKET: ${{ vars.CI_ARTIFACTS_BUCKET }}



  ### Finalize ###

  finalize:
    name: Finalize
    environment: test
    permissions:
      id-token: write
    needs:
      - publish
      - test_centos_8-3_4-normal
      - test_centos_8-3_4-jemalloc
      - test_centos_8-3_4-malloctrim
      - test_centos_8-3_3-normal
      - test_centos_8-3_3-jemalloc
      - test_centos_8-3_3-malloctrim
      - test_centos_8-3_2-normal
      - test_centos_8-3_2-jemalloc
      - test_centos_8-3_2-malloctrim
      - test_centos_8-3_4_3-normal
      - test_centos_8-3_4_3-jemalloc
      - test_centos_8-3_4_3-malloctrim
      - test_centos_8-3_3_8-normal
      - test_centos_8-3_3_8-jemalloc
      - test_centos_8-3_3_8-malloctrim
      - test_centos_8-3_2_8-normal
      - test_centos_8-3_2_8-jemalloc
      - test_centos_8-3_2_8-malloctrim
      - test_debian_10-3_4-normal
      - test_debian_10-3_4-jemalloc
      - test_debian_10-3_4-malloctrim
      - test_debian_10-3_3-normal
      - test_debian_10-3_3-jemalloc
      - test_debian_10-3_3-malloctrim
      - test_debian_10-3_2-normal
      - test_debian_10-3_2-jemalloc
      - test_debian_10-3_2-malloctrim
      - test_debian_10-3_1-normal
      - test_debian_10-3_1-jemalloc
      - test_debian_10-3_1-malloctrim
      - test_debian_10-3_4_3-normal
      - test_debian_10-3_4_3-jemalloc
      - test_debian_10-3_4_3-malloctrim
      - test_debian_10-3_3_8-normal
      - test_debian_10-3_3_8-jemalloc
      - test_debian_10-3_3_8-malloctrim
      - test_debian_10-3_2_8-normal
      - test_debian_10-3_2_8-jemalloc
      - test_debian_10-3_2_8-malloctrim
      - test_debian_10-3_1_7-normal
      - test_debian_10-3_1_7-jemalloc
      - test_debian_10-3_1_7-malloctrim
      - test_debian_11-3_4-normal
      - test_debian_11-3_4-jemalloc
      - test_debian_11-3_4-malloctrim
      - test_debian_11-3_3-normal
      - test_debian_11-3_3-jemalloc
      - test_debian_11-3_3-malloctrim
      - test_debian_11-3_2-normal
      - test_debian_11-3_2-jemalloc
      - test_debian_11-3_2-malloctrim
      - test_debian_11-3_1-normal
      - test_debian_11-3_1-jemalloc
      - test_debian_11-3_1-malloctrim
      - test_debian_11-3_4_3-normal
      - test_debian_11-3_4_3-jemalloc
      - test_debian_11-3_4_3-malloctrim
      - test_debian_11-3_3_8-normal
      - test_debian_11-3_3_8-jemalloc
      - test_debian_11-3_3_8-malloctrim
      - test_debian_11-3_2_8-normal
      - test_debian_11-3_2_8-jemalloc
      - test_debian_11-3_2_8-malloctrim
      - test_debian_11-3_1_7-normal
      - test_debian_11-3_1_7-jemalloc
      - test_debian_11-3_1_7-malloctrim
      - test_debian_12-3_4-normal
      - test_debian_12-3_4-jemalloc
      - test_debian_12-3_4-malloctrim
      - test_debian_12-3_3-normal
      - test_debian_12-3_3-jemalloc
      - test_debian_12-3_3-malloctrim
      - test_debian_12-3_2-normal
      - test_debian_12-3_2-jemalloc
      - test_debian_12-3_2-malloctrim
      - test_debian_12-3_4_3-normal
      - test_debian_12-3_4_3-jemalloc
      - test_debian_12-3_4_3-malloctrim
      - test_debian_12-3_3_8-normal
      - test_debian_12-3_3_8-jemalloc
      - test_debian_12-3_3_8-malloctrim
      - test_debian_12-3_2_8-normal
      - test_debian_12-3_2_8-jemalloc
      - test_debian_12-3_2_8-malloctrim
      - test_el_9-3_4-normal
      - test_el_9-3_4-jemalloc
      - test_el_9-3_4-malloctrim
      - test_el_9-3_3-normal
      - test_el_9-3_3-jemalloc
      - test_el_9-3_3-malloctrim
      - test_el_9-3_2-normal
      - test_el_9-3_2-jemalloc
      - test_el_9-3_2-malloctrim
      - test_el_9-3_1-normal
      - test_el_9-3_1-jemalloc
      - test_el_9-3_1-malloctrim
      - test_el_9-3_4_3-normal
      - test_el_9-3_4_3-jemalloc
      - test_el_9-3_4_3-malloctrim
      - test_el_9-3_3_8-normal
      - test_el_9-3_3_8-jemalloc
      - test_el_9-3_3_8-malloctrim
      - test_el_9-3_2_8-normal
      - test_el_9-3_2_8-jemalloc
      - test_el_9-3_2_8-malloctrim
      - test_el_9-3_1_7-normal
      - test_el_9-3_1_7-jemalloc
      - test_el_9-3_1_7-malloctrim
      - test_ubuntu_20_04-3_4-normal
      - test_ubuntu_20_04-3_4-jemalloc
      - test_ubuntu_20_04-3_4-malloctrim
      - test_ubuntu_20_04-3_3-normal
      - test_ubuntu_20_04-3_3-jemalloc
      - test_ubuntu_20_04-3_3-malloctrim
      - test_ubuntu_20_04-3_2-normal
      - test_ubuntu_20_04-3_2-jemalloc
      - test_ubuntu_20_04-3_2-malloctrim
      - test_ubuntu_20_04-3_1-normal
      - test_ubuntu_20_04-3_1-jemalloc
      - test_ubuntu_20_04-3_1-malloctrim
      - test_ubuntu_20_04-3_4_3-normal
      - test_ubuntu_20_04-3_4_3-jemalloc
      - test_ubuntu_20_04-3_4_3-malloctrim
      - test_ubuntu_20_04-3_3_8-normal
      - test_ubuntu_20_04-3_3_8-jemalloc
      - test_ubuntu_20_04-3_3_8-malloctrim
      - test_ubuntu_20_04-3_2_8-normal
      - test_ubuntu_20_04-3_2_8-jemalloc
      - test_ubuntu_20_04-3_2_8-malloctrim
      - test_ubuntu_20_04-3_1_7-normal
      - test_ubuntu_20_04-3_1_7-jemalloc
      - test_ubuntu_20_04-3_1_7-malloctrim
      - test_ubuntu_22_04-3_4-normal
      - test_ubuntu_22_04-3_4-jemalloc
      - test_ubuntu_22_04-3_4-malloctrim
      - test_ubuntu_22_04-3_3-normal
      - test_ubuntu_22_04-3_3-jemalloc
      - test_ubuntu_22_04-3_3-malloctrim
      - test_ubuntu_22_04-3_2-normal
      - test_ubuntu_22_04-3_2-jemalloc
      - test_ubuntu_22_04-3_2-malloctrim
      - test_ubuntu_22_04-3_1-normal
      - test_ubuntu_22_04-3_1-jemalloc
      - test_ubuntu_22_04-3_1-malloctrim
      - test_ubuntu_22_04-3_4_3-normal
      - test_ubuntu_22_04-3_4_3-jemalloc
      - test_ubuntu_22_04-3_4_3-malloctrim
      - test_ubuntu_22_04-3_3_8-normal
      - test_ubuntu_22_04-3_3_8-jemalloc
      - test_ubuntu_22_04-3_3_8-malloctrim
      - test_ubuntu_22_04-3_2_8-normal
      - test_ubuntu_22_04-3_2_8-jemalloc
      - test_ubuntu_22_04-3_2_8-malloctrim
      - test_ubuntu_22_04-3_1_7-normal
      - test_ubuntu_22_04-3_1_7-jemalloc
      - test_ubuntu_22_04-3_1_7-malloctrim
      - test_ubuntu_24_04-3_4-normal
      - test_ubuntu_24_04-3_4-jemalloc
      - test_ubuntu_24_04-3_4-malloctrim
      - test_ubuntu_24_04-3_3-normal
      - test_ubuntu_24_04-3_3-jemalloc
      - test_ubuntu_24_04-3_3-malloctrim
      - test_ubuntu_24_04-3_2-normal
      - test_ubuntu_24_04-3_2-jemalloc
      - test_ubuntu_24_04-3_2-malloctrim
      - test_ubuntu_24_04-3_1-normal
      - test_ubuntu_24_04-3_1-jemalloc
      - test_ubuntu_24_04-3_1-malloctrim
      - test_ubuntu_24_04-3_4_3-normal
      - test_ubuntu_24_04-3_4_3-jemalloc
      - test_ubuntu_24_04-3_4_3-malloctrim
      - test_ubuntu_24_04-3_3_8-normal
      - test_ubuntu_24_04-3_3_8-jemalloc
      - test_ubuntu_24_04-3_3_8-malloctrim
      - test_ubuntu_24_04-3_2_8-normal
      - test_ubuntu_24_04-3_2_8-jemalloc
      - test_ubuntu_24_04-3_2_8-malloctrim
      - test_ubuntu_24_04-3_1_7-normal
      - test_ubuntu_24_04-3_1_7-jemalloc
      - test_ubuntu_24_04-3_1_7-malloctrim
    runs-on: ubuntu-24.04
    if: 'always()'
    steps:
      - uses: actions/checkout@v4


      ### Check whether dependent jobs failed ###

      - name: Check whether 'Publish packages' succeeded
        run: 'false'
        if: needs.publish.result != 'success'

      - name: Check whether 'Test [centos-8/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_4-normal.result != 'success'
          && (needs.test_centos_8-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4/normal];'))
      - name: Check whether 'Test [centos-8/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_4-jemalloc.result != 'success'
          && (needs.test_centos_8-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4/jemalloc];'))
      - name: Check whether 'Test [centos-8/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_4-malloctrim.result != 'success'
          && (needs.test_centos_8-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4/malloctrim];'))
      - name: Check whether 'Test [centos-8/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_3-normal.result != 'success'
          && (needs.test_centos_8-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3/normal];'))
      - name: Check whether 'Test [centos-8/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_3-jemalloc.result != 'success'
          && (needs.test_centos_8-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3/jemalloc];'))
      - name: Check whether 'Test [centos-8/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_3-malloctrim.result != 'success'
          && (needs.test_centos_8-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3/malloctrim];'))
      - name: Check whether 'Test [centos-8/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_2-normal.result != 'success'
          && (needs.test_centos_8-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2/normal];'))
      - name: Check whether 'Test [centos-8/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_2-jemalloc.result != 'success'
          && (needs.test_centos_8-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2/jemalloc];'))
      - name: Check whether 'Test [centos-8/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_2-malloctrim.result != 'success'
          && (needs.test_centos_8-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2/malloctrim];'))
      - name: Check whether 'Test [centos-8/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_4_3-normal.result != 'success'
          && (needs.test_centos_8-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4.3/normal];'))
      - name: Check whether 'Test [centos-8/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_4_3-jemalloc.result != 'success'
          && (needs.test_centos_8-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4.3/jemalloc];'))
      - name: Check whether 'Test [centos-8/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_4_3-malloctrim.result != 'success'
          && (needs.test_centos_8-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.4.3/malloctrim];'))
      - name: Check whether 'Test [centos-8/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_3_8-normal.result != 'success'
          && (needs.test_centos_8-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3.8/normal];'))
      - name: Check whether 'Test [centos-8/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_3_8-jemalloc.result != 'success'
          && (needs.test_centos_8-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3.8/jemalloc];'))
      - name: Check whether 'Test [centos-8/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_3_8-malloctrim.result != 'success'
          && (needs.test_centos_8-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.3.8/malloctrim];'))
      - name: Check whether 'Test [centos-8/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_2_8-normal.result != 'success'
          && (needs.test_centos_8-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2.8/normal];'))
      - name: Check whether 'Test [centos-8/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_2_8-jemalloc.result != 'success'
          && (needs.test_centos_8-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2.8/jemalloc];'))
      - name: Check whether 'Test [centos-8/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_centos_8-3_2_8-malloctrim.result != 'success'
          && (needs.test_centos_8-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [centos-8/3.2.8/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_4-normal.result != 'success'
          && (needs.test_debian_10-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4/normal];'))
      - name: Check whether 'Test [debian-10/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_4-jemalloc.result != 'success'
          && (needs.test_debian_10-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_4-malloctrim.result != 'success'
          && (needs.test_debian_10-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_3-normal.result != 'success'
          && (needs.test_debian_10-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3/normal];'))
      - name: Check whether 'Test [debian-10/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_3-jemalloc.result != 'success'
          && (needs.test_debian_10-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_3-malloctrim.result != 'success'
          && (needs.test_debian_10-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_2-normal.result != 'success'
          && (needs.test_debian_10-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2/normal];'))
      - name: Check whether 'Test [debian-10/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_2-jemalloc.result != 'success'
          && (needs.test_debian_10-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_2-malloctrim.result != 'success'
          && (needs.test_debian_10-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.1/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_1-normal.result != 'success'
          && (needs.test_debian_10-3_1-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1/normal];'))
      - name: Check whether 'Test [debian-10/3.1/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_1-jemalloc.result != 'success'
          && (needs.test_debian_10-3_1-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.1/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_1-malloctrim.result != 'success'
          && (needs.test_debian_10-3_1-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_4_3-normal.result != 'success'
          && (needs.test_debian_10-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4.3/normal];'))
      - name: Check whether 'Test [debian-10/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_4_3-jemalloc.result != 'success'
          && (needs.test_debian_10-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4.3/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_4_3-malloctrim.result != 'success'
          && (needs.test_debian_10-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.4.3/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_3_8-normal.result != 'success'
          && (needs.test_debian_10-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3.8/normal];'))
      - name: Check whether 'Test [debian-10/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_3_8-jemalloc.result != 'success'
          && (needs.test_debian_10-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3.8/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_3_8-malloctrim.result != 'success'
          && (needs.test_debian_10-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.3.8/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_2_8-normal.result != 'success'
          && (needs.test_debian_10-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2.8/normal];'))
      - name: Check whether 'Test [debian-10/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_2_8-jemalloc.result != 'success'
          && (needs.test_debian_10-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2.8/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_2_8-malloctrim.result != 'success'
          && (needs.test_debian_10-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.2.8/malloctrim];'))
      - name: Check whether 'Test [debian-10/3.1.7/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_1_7-normal.result != 'success'
          && (needs.test_debian_10-3_1_7-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1.7/normal];'))
      - name: Check whether 'Test [debian-10/3.1.7/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_1_7-jemalloc.result != 'success'
          && (needs.test_debian_10-3_1_7-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1.7/jemalloc];'))
      - name: Check whether 'Test [debian-10/3.1.7/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_10-3_1_7-malloctrim.result != 'success'
          && (needs.test_debian_10-3_1_7-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-10/3.1.7/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_4-normal.result != 'success'
          && (needs.test_debian_11-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4/normal];'))
      - name: Check whether 'Test [debian-11/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_4-jemalloc.result != 'success'
          && (needs.test_debian_11-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_4-malloctrim.result != 'success'
          && (needs.test_debian_11-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_3-normal.result != 'success'
          && (needs.test_debian_11-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3/normal];'))
      - name: Check whether 'Test [debian-11/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_3-jemalloc.result != 'success'
          && (needs.test_debian_11-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_3-malloctrim.result != 'success'
          && (needs.test_debian_11-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_2-normal.result != 'success'
          && (needs.test_debian_11-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2/normal];'))
      - name: Check whether 'Test [debian-11/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_2-jemalloc.result != 'success'
          && (needs.test_debian_11-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_2-malloctrim.result != 'success'
          && (needs.test_debian_11-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.1/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_1-normal.result != 'success'
          && (needs.test_debian_11-3_1-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1/normal];'))
      - name: Check whether 'Test [debian-11/3.1/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_1-jemalloc.result != 'success'
          && (needs.test_debian_11-3_1-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.1/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_1-malloctrim.result != 'success'
          && (needs.test_debian_11-3_1-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_4_3-normal.result != 'success'
          && (needs.test_debian_11-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4.3/normal];'))
      - name: Check whether 'Test [debian-11/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_4_3-jemalloc.result != 'success'
          && (needs.test_debian_11-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4.3/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_4_3-malloctrim.result != 'success'
          && (needs.test_debian_11-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.4.3/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_3_8-normal.result != 'success'
          && (needs.test_debian_11-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3.8/normal];'))
      - name: Check whether 'Test [debian-11/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_3_8-jemalloc.result != 'success'
          && (needs.test_debian_11-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3.8/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_3_8-malloctrim.result != 'success'
          && (needs.test_debian_11-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.3.8/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_2_8-normal.result != 'success'
          && (needs.test_debian_11-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2.8/normal];'))
      - name: Check whether 'Test [debian-11/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_2_8-jemalloc.result != 'success'
          && (needs.test_debian_11-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2.8/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_2_8-malloctrim.result != 'success'
          && (needs.test_debian_11-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.2.8/malloctrim];'))
      - name: Check whether 'Test [debian-11/3.1.7/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_1_7-normal.result != 'success'
          && (needs.test_debian_11-3_1_7-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1.7/normal];'))
      - name: Check whether 'Test [debian-11/3.1.7/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_1_7-jemalloc.result != 'success'
          && (needs.test_debian_11-3_1_7-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1.7/jemalloc];'))
      - name: Check whether 'Test [debian-11/3.1.7/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_11-3_1_7-malloctrim.result != 'success'
          && (needs.test_debian_11-3_1_7-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-11/3.1.7/malloctrim];'))
      - name: Check whether 'Test [debian-12/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_4-normal.result != 'success'
          && (needs.test_debian_12-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4/normal];'))
      - name: Check whether 'Test [debian-12/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_4-jemalloc.result != 'success'
          && (needs.test_debian_12-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4/jemalloc];'))
      - name: Check whether 'Test [debian-12/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_4-malloctrim.result != 'success'
          && (needs.test_debian_12-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4/malloctrim];'))
      - name: Check whether 'Test [debian-12/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_3-normal.result != 'success'
          && (needs.test_debian_12-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3/normal];'))
      - name: Check whether 'Test [debian-12/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_3-jemalloc.result != 'success'
          && (needs.test_debian_12-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3/jemalloc];'))
      - name: Check whether 'Test [debian-12/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_3-malloctrim.result != 'success'
          && (needs.test_debian_12-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3/malloctrim];'))
      - name: Check whether 'Test [debian-12/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_2-normal.result != 'success'
          && (needs.test_debian_12-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2/normal];'))
      - name: Check whether 'Test [debian-12/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_2-jemalloc.result != 'success'
          && (needs.test_debian_12-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2/jemalloc];'))
      - name: Check whether 'Test [debian-12/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_2-malloctrim.result != 'success'
          && (needs.test_debian_12-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2/malloctrim];'))
      - name: Check whether 'Test [debian-12/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_4_3-normal.result != 'success'
          && (needs.test_debian_12-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4.3/normal];'))
      - name: Check whether 'Test [debian-12/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_4_3-jemalloc.result != 'success'
          && (needs.test_debian_12-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4.3/jemalloc];'))
      - name: Check whether 'Test [debian-12/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_4_3-malloctrim.result != 'success'
          && (needs.test_debian_12-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.4.3/malloctrim];'))
      - name: Check whether 'Test [debian-12/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_3_8-normal.result != 'success'
          && (needs.test_debian_12-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3.8/normal];'))
      - name: Check whether 'Test [debian-12/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_3_8-jemalloc.result != 'success'
          && (needs.test_debian_12-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3.8/jemalloc];'))
      - name: Check whether 'Test [debian-12/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_3_8-malloctrim.result != 'success'
          && (needs.test_debian_12-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.3.8/malloctrim];'))
      - name: Check whether 'Test [debian-12/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_2_8-normal.result != 'success'
          && (needs.test_debian_12-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2.8/normal];'))
      - name: Check whether 'Test [debian-12/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_2_8-jemalloc.result != 'success'
          && (needs.test_debian_12-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2.8/jemalloc];'))
      - name: Check whether 'Test [debian-12/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_debian_12-3_2_8-malloctrim.result != 'success'
          && (needs.test_debian_12-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [debian-12/3.2.8/malloctrim];'))
      - name: Check whether 'Test [el-9/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_4-normal.result != 'success'
          && (needs.test_el_9-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4/normal];'))
      - name: Check whether 'Test [el-9/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_4-jemalloc.result != 'success'
          && (needs.test_el_9-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4/jemalloc];'))
      - name: Check whether 'Test [el-9/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_4-malloctrim.result != 'success'
          && (needs.test_el_9-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4/malloctrim];'))
      - name: Check whether 'Test [el-9/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_3-normal.result != 'success'
          && (needs.test_el_9-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3/normal];'))
      - name: Check whether 'Test [el-9/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_3-jemalloc.result != 'success'
          && (needs.test_el_9-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3/jemalloc];'))
      - name: Check whether 'Test [el-9/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_3-malloctrim.result != 'success'
          && (needs.test_el_9-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3/malloctrim];'))
      - name: Check whether 'Test [el-9/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_2-normal.result != 'success'
          && (needs.test_el_9-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2/normal];'))
      - name: Check whether 'Test [el-9/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_2-jemalloc.result != 'success'
          && (needs.test_el_9-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2/jemalloc];'))
      - name: Check whether 'Test [el-9/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_2-malloctrim.result != 'success'
          && (needs.test_el_9-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2/malloctrim];'))
      - name: Check whether 'Test [el-9/3.1/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_1-normal.result != 'success'
          && (needs.test_el_9-3_1-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1/normal];'))
      - name: Check whether 'Test [el-9/3.1/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_1-jemalloc.result != 'success'
          && (needs.test_el_9-3_1-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1/jemalloc];'))
      - name: Check whether 'Test [el-9/3.1/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_1-malloctrim.result != 'success'
          && (needs.test_el_9-3_1-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1/malloctrim];'))
      - name: Check whether 'Test [el-9/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_4_3-normal.result != 'success'
          && (needs.test_el_9-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4.3/normal];'))
      - name: Check whether 'Test [el-9/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_4_3-jemalloc.result != 'success'
          && (needs.test_el_9-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4.3/jemalloc];'))
      - name: Check whether 'Test [el-9/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_4_3-malloctrim.result != 'success'
          && (needs.test_el_9-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.4.3/malloctrim];'))
      - name: Check whether 'Test [el-9/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_3_8-normal.result != 'success'
          && (needs.test_el_9-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3.8/normal];'))
      - name: Check whether 'Test [el-9/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_3_8-jemalloc.result != 'success'
          && (needs.test_el_9-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3.8/jemalloc];'))
      - name: Check whether 'Test [el-9/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_3_8-malloctrim.result != 'success'
          && (needs.test_el_9-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.3.8/malloctrim];'))
      - name: Check whether 'Test [el-9/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_2_8-normal.result != 'success'
          && (needs.test_el_9-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2.8/normal];'))
      - name: Check whether 'Test [el-9/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_2_8-jemalloc.result != 'success'
          && (needs.test_el_9-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2.8/jemalloc];'))
      - name: Check whether 'Test [el-9/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_2_8-malloctrim.result != 'success'
          && (needs.test_el_9-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.2.8/malloctrim];'))
      - name: Check whether 'Test [el-9/3.1.7/normal]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_1_7-normal.result != 'success'
          && (needs.test_el_9-3_1_7-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1.7/normal];'))
      - name: Check whether 'Test [el-9/3.1.7/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_1_7-jemalloc.result != 'success'
          && (needs.test_el_9-3_1_7-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1.7/jemalloc];'))
      - name: Check whether 'Test [el-9/3.1.7/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_el_9-3_1_7-malloctrim.result != 'success'
          && (needs.test_el_9-3_1_7-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [el-9/3.1.7/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_4-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_4-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_4-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_3-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_3-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_3-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_2-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_2-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_2-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.1/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_1-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_1-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.1/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_1-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_1-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.1/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_1-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_1-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_4_3-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4.3/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_4_3-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4.3/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_4_3-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.4.3/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_3_8-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3.8/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_3_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_3_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.3.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_2_8-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2.8/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_2_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_2_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.2.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-20.04/3.1.7/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_1_7-normal.result != 'success'
          && (needs.test_ubuntu_20_04-3_1_7-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1.7/normal];'))
      - name: Check whether 'Test [ubuntu-20.04/3.1.7/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_1_7-jemalloc.result != 'success'
          && (needs.test_ubuntu_20_04-3_1_7-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1.7/jemalloc];'))
      - name: Check whether 'Test [ubuntu-20.04/3.1.7/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_20_04-3_1_7-malloctrim.result != 'success'
          && (needs.test_ubuntu_20_04-3_1_7-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-20.04/3.1.7/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_4-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_4-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_4-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_3-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_3-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_3-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_2-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_2-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_2-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.1/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_1-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_1-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.1/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_1-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_1-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.1/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_1-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_1-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_4_3-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4.3/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_4_3-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4.3/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_4_3-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.4.3/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_3_8-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3.8/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_3_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_3_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.3.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_2_8-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2.8/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_2_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_2_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.2.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-22.04/3.1.7/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_1_7-normal.result != 'success'
          && (needs.test_ubuntu_22_04-3_1_7-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1.7/normal];'))
      - name: Check whether 'Test [ubuntu-22.04/3.1.7/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_1_7-jemalloc.result != 'success'
          && (needs.test_ubuntu_22_04-3_1_7-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1.7/jemalloc];'))
      - name: Check whether 'Test [ubuntu-22.04/3.1.7/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_22_04-3_1_7-malloctrim.result != 'success'
          && (needs.test_ubuntu_22_04-3_1_7-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-22.04/3.1.7/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.4/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_4-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_4-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.4/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_4-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_4-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.4/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_4-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_4-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_3-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_3-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_3-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.2/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_2-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_2-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.2/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_2-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_2-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.2/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_2-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_2-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.1/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_1-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_1-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.1/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_1-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_1-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.1/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_1-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_1-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.4.3/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_4_3-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_4_3-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4.3/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.4.3/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_4_3-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_4_3-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4.3/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.4.3/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_4_3-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_4_3-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.4.3/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.3.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_3_8-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_3_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3.8/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.3.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_3_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_3_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.3.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_3_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_3_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.3.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.2.8/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_2_8-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_2_8-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2.8/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.2.8/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_2_8-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_2_8-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2.8/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.2.8/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_2_8-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_2_8-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.2.8/malloctrim];'))
      - name: Check whether 'Test [ubuntu-24.04/3.1.7/normal]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_1_7-normal.result != 'success'
          && (needs.test_ubuntu_24_04-3_1_7-normal.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1.7/normal];'))
      - name: Check whether 'Test [ubuntu-24.04/3.1.7/jemalloc]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_1_7-jemalloc.result != 'success'
          && (needs.test_ubuntu_24_04-3_1_7-jemalloc.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1.7/jemalloc];'))
      - name: Check whether 'Test [ubuntu-24.04/3.1.7/malloctrim]' did not fail
        run: 'false'
        if: |
          needs.test_ubuntu_24_04-3_1_7-malloctrim.result != 'success'
          && (needs.test_ubuntu_24_04-3_1_7-malloctrim.result != 'skipped'
            || contains(inputs.necessary_jobs, ';Test against test repo [ubuntu-24.04/3.1.7/malloctrim];'))
